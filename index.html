<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ë¯¸ìˆ˜ê¸ˆ í˜„í™©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');

        :root {
            --primary: #0F172A;
            --primary-light: #1E293B;
            --accent: #3B82F6;
            --accent-hover: #2563EB;
            --success: #27ae60;
            --warning: #e67e22;
            --danger: #c0392b;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #2c3e50;
            --text-light: #7f8c8d;
            --text-muted: #95a5a6;
            --border: #e0e4e8;
            --shadow: 0 1px 3px rgba(0,0,0,0.04);
            --shadow-lg: 0 2px 8px rgba(0,0,0,0.06);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text);
            font-size: 14px;
        }

        .header {
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 0 30px;
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header h1 {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .update-badge {
            font-size: 0.8rem;
            color: #94A3B8;
        }
        .live-badge {
            background: var(--accent);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        /* ê³ ì • í”Œë¡œíŒ… ì—…ë¡œë“œ ë²„íŠ¼ */
        .upload-floating {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
        }
        .upload-floating-btn {
            padding: 10px 18px;
            border-radius: 24px;
            background: rgba(120, 120, 140, 0.25);
            border: none;
            cursor: pointer;
            font-size: 12px;
            color: rgba(100, 100, 120, 0.6);
            transition: all 0.3s;
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .upload-floating-btn:hover {
            background: rgba(59, 130, 246, 0.75);
            color: white;
        }

        .btn {
            padding: 9px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .btn:hover { transform: translateY(-1px); }
        .btn-sm { padding: 7px 12px; font-size: 12px; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-outline { background: white; border: 1px solid var(--border); color: var(--text); }
        .btn-outline:hover { border-color: var(--accent); color: var(--accent); }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }

        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        .card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .card-title .count-badge {
            background: #5a6c7d;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 16px 18px;
            border: 1px solid var(--border);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            letter-spacing: 0.3px;
        }
        .stat-label-left {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #e8ebee;
            color: #7f8c8d;
            font-size: 10px;
            font-weight: 700;
            cursor: help;
            position: relative;
            flex-shrink: 0;
        }
        .tooltip-icon .tooltip-text {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            top: 0;
            left: calc(100% + 10px);
            background: #ffffff;
            color: #334155;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 400;
            white-space: nowrap;
            min-width: auto;
            max-width: 400px;
            z-index: 200;
            line-height: 1.6;
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            border: 1px solid #e2e8f0;
            transition: opacity 0.2s;
            text-transform: none;
            letter-spacing: 0;
        }
        .tooltip-icon .tooltip-text::after {
            content: '';
            position: absolute;
            top: 6px;
            left: -6px;
            border: 6px solid transparent;
            border-right-color: #ffffff;
        }
        .tooltip-icon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .stat-change {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }
        .stat-change.up { background: #fdecea; color: #c0392b; }
        .stat-change.down { background: #e8f6ef; color: #27ae60; }
        .stat-value {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--text);
        }
        .stat-sub { font-size: 11px; color: var(--text-muted); }

        .track-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        .track-card {
            background: white;
            border-radius: 8px;
            padding: 18px;
            border: 1px solid var(--border);
        }
        .track-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .track-header-left {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .track-header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .track-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }
        .track-count {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 500;
            background: var(--bg);
            color: var(--text-light);
        }
        .track-stage-info {
            font-size: 10px;
            color: var(--text-muted);
            margin-bottom: 10px;
            padding: 6px 10px;
            background: #f8f9fa;
            border-radius: 4px;
            line-height: 1.5;
        }
        .toggle-group-sm {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            color: var(--text-muted);
        }
        .toggle-switch-sm {
            position: relative;
            width: 32px;
            height: 18px;
        }
        .toggle-switch-sm input { opacity: 0; width: 0; height: 0; }
        .toggle-slider-sm {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #dfe4ea;
            border-radius: 18px;
            transition: 0.3s;
        }
        .toggle-slider-sm::before {
            position: absolute;
            content: '';
            height: 14px;
            width: 14px;
            left: 2px;
            bottom: 2px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .toggle-switch-sm input:checked + .toggle-slider-sm { background: var(--accent); }
        .toggle-switch-sm input:checked + .toggle-slider-sm::before { transform: translateX(14px); }
        .track-total {
            font-size: 18px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 12px;
        }

        .stat-card.clickable {
            cursor: pointer;
            transition: all 0.2s;
        }
        .stat-card.clickable:hover {
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .stage-bar {
            display: flex;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            background: #eceff1;
            margin-bottom: 12px;
        }
        .stage-bar .normal { background: #7cb342; }
        .stage-bar .manage { background: #e67e22; }
        .stage-bar .overdue { background: #c0392b; }

        .stage-detail {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }
        .stage-item {
            text-align: center;
            padding: 8px 6px;
            background: var(--bg);
            border-radius: 6px;
        }
        .stage-item-label { font-size: 10px; color: var(--text-muted); margin-bottom: 3px; }
        .stage-item-value { font-size: 13px; font-weight: 700; }
        .stage-item.normal .stage-item-value { color: #558b2f; }
        .stage-item.manage .stage-item-value { color: #d35400; }
        .stage-item.overdue .stage-item-value { color: #a93226; }
        .stage-item-sub { font-size: 9px; color: var(--text-muted); margin-top: 2px; }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }

        /* ê²½ê³¼ì¼ êµ¬ê°„ ë¶„í¬ */
        .distribution-bar {
            display: flex;
            height: 28px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .distribution-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: 600;
            min-width: 36px;
        }
        .dist-30 { background: #7cb342; }
        .dist-60 { background: #e67e22; }
        .dist-90 { background: #d35400; }
        .dist-over { background: #c0392b; }

        .distribution-legend {
            display: flex;
            font-size: 11px;
            color: var(--text-muted);
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 0;
        }
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        /* ì•¡ì…˜ í•„ìš” ë¦¬ìŠ¤íŠ¸ */
        .action-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .action-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
            margin-bottom: 6px;
            border-left: 3px solid var(--danger);
        }
        .action-item.warning { border-left-color: var(--warning); }
        .action-item.info { border-left-color: var(--accent); }
        .action-info { flex: 1; }
        .action-title { font-weight: 600; font-size: 13px; margin-bottom: 2px; }
        .action-sub { font-size: 11px; color: var(--text-muted); }
        .action-value { text-align: right; }
        .action-amount { font-size: 14px; font-weight: 700; color: var(--text); }
        .action-days { font-size: 11px; color: var(--danger); font-weight: 600; }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .data-table th {
            background: #fafbfc;
            padding: 11px 12px;
            text-align: left;
            font-weight: 600;
            color: var(--text);
            border-bottom: 1px solid var(--border);
            font-size: 12px;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }
        .data-table th:hover { background: #f0f2f5; }
        .data-table th .sort-icon { margin-left: 4px; opacity: 0.4; }
        .data-table th.sorted .sort-icon { opacity: 1; color: var(--accent); }
        .data-table td {
            padding: 11px 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        .data-table tbody tr:hover { background: #fafbfc; }
        .data-table tbody tr.clickable { cursor: pointer; }
        .data-table .amount { text-align: right; font-weight: 600; }
        .data-table .center { text-align: center; }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 7px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
        }
        .badge-success { background: #e8f6ef; color: #1e8449; }
        .badge-warning { background: #fef5e7; color: #d35400; }
        .badge-danger { background: #fdecea; color: #a93226; }
        .badge-purple { background: #f4ecf7; color: #6c3483; }
        .badge-info { background: #eaf2f8; color: #2874a6; }

        .tab-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .tab-btn {
            padding: 10px 20px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: white;
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .tab-btn:hover { border-color: var(--accent); color: var(--accent); }
        .tab-btn.active { background: var(--accent); border-color: var(--accent); color: white; }

        .filter-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            gap: 12px;
            flex-wrap: wrap;
        }
        .filter-left { display: flex; align-items: center; gap: 8px; }
        .filter-right { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .filter-select {
            padding: 9px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            background: white;
            min-width: 100px;
        }
        .filter-select:focus { outline: none; border-color: var(--accent); }
        .search-input {
            padding: 9px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            width: 180px;
        }
        .search-input:focus { outline: none; border-color: var(--accent); }

        .rank-list { max-height: 400px; overflow-y: auto; }
        .rank-sort-toggle { display: flex; gap: 2px; background: #f1f5f9; border-radius: 6px; padding: 2px; }
        .rank-sort-btn { padding: 3px 10px; border: none; background: transparent; border-radius: 4px; font-size: 11px; cursor: pointer; color: #64748b; transition: all 0.2s; }
        .rank-sort-btn.active { background: white; color: var(--text); font-weight: 600; box-shadow: 0 1px 2px rgba(0,0,0,0.08); }
        .rank-track-tabs { display: flex; gap: 4px; }
        .rank-track-tabs .mini-tab { font-size: 11px; padding: 3px 10px; }

        /* ë¯¸ë‹ˆ íƒ­ */
        .mini-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        .mini-tab {
            padding: 5px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: white;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }
        .mini-tab:hover { border-color: var(--accent); color: var(--accent); }
        .mini-tab.active { background: var(--accent); border-color: var(--accent); color: white; }

        .rank-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
            margin-bottom: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .rank-item:hover { background: #eef0f2; transform: translateX(2px); }
        .rank-num {
            width: 22px;
            height: 22px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            margin-right: 10px;
            background: #e8ebee;
            color: var(--text-light);
        }
        .rank-num.top3 { background: #5a6c7d; color: white; }
        .rank-info { flex: 1; }
        .rank-name { font-weight: 600; font-size: 13px; margin-bottom: 2px; }
        .rank-sub { font-size: 11px; color: var(--text-muted); }
        .rank-value { text-align: right; }
        .rank-amount { font-size: 14px; font-weight: 700; color: var(--text); }
        .rank-amount.highlight { color: #c0392b; }
        .rank-days { font-size: 11px; color: var(--text-muted); margin-top: 2px; }

        .toggle-group {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-muted);
        }
        .toggle-switch {
            position: relative;
            width: 40px;
            height: 22px;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #dfe4ea;
            border-radius: 22px;
            transition: 0.3s;
        }
        .toggle-slider::before {
            position: absolute;
            content: '';
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .toggle-switch input:checked + .toggle-slider { background: var(--accent); }
        .toggle-switch input:checked + .toggle-slider::before { transform: translateX(18px); }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4px;
            padding: 16px;
        }
        .page-btn {
            min-width: 32px;
            height: 32px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
        }
        .page-btn:hover { border-color: var(--accent); color: var(--accent); }
        .page-btn.active { background: var(--accent); border-color: var(--accent); color: white; }
        .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .page-info { font-size: 12px; color: var(--text-muted); margin-left: 12px; }

        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 1100px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }
        .modal-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 { font-weight: 600; font-size: 15px; }
        .modal-body { padding: 20px; max-height: 60vh; overflow-y: auto; }
        .close-btn {
            background: var(--bg);
            border: none;
            font-size: 18px;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-btn:hover { background: #e8eaed; }

        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 10px;
            padding: 28px;
            text-align: center;
            cursor: pointer;
        }
        .upload-zone:hover { border-color: var(--accent); background: #fafbfc; }
        .upload-zone input { display: none; }
        .upload-icon { font-size: 36px; margin-bottom: 10px; }
        .upload-text { color: var(--text-light); font-size: 13px; }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-light);
        }
        .empty-state-icon { font-size: 56px; margin-bottom: 16px; opacity: 0.6; }
        .empty-state-text { font-size: 15px; margin-bottom: 20px; }

        .company-detail-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }
        .company-detail-item:last-child { border-bottom: none; }

        /* í†µí•© ìˆœìœ„ ì¹´ë“œ ì •ë ¬ ë²„íŠ¼ */
        .sort-toggle-group {
            display: flex;
            gap: 4px;
        }
        .sort-toggle-btn {
            padding: 4px 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: white;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }
        .sort-toggle-btn:hover { border-color: var(--accent); color: var(--accent); }
        .sort-toggle-btn.active { background: var(--accent); border-color: var(--accent); color: white; }

        @media (max-width: 1200px) {
            .summary-grid { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 1024px) {
            .summary-grid { grid-template-columns: repeat(2, 1fr); }
            .track-grid { grid-template-columns: 1fr; }
            .grid-3 { grid-template-columns: 1fr; }
            .grid-4 { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .container { padding: 16px; }
            .header { padding: 0 16px; flex-wrap: wrap; gap: 10px; height: auto; padding-top: 12px; padding-bottom: 12px; }
            .summary-grid { grid-template-columns: 1fr 1fr; }
            .grid-2 { grid-template-columns: 1fr; }
            .stat-value { font-size: 18px; }
            .filter-bar { flex-direction: column; align-items: stretch; }
            .filter-right { flex-direction: column; }
            .search-input { width: 100%; }
            .filter-select { width: 100%; }
        }

        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š (ì£¼) ë„·í¼ì•Œì•¤ë”” 2026ë…„ ë§¤ì¶œí˜„í™©</h1>
        <div class="header-right">
            <span style="font-size: 11px; color: #F59E0B; background: rgba(245,158,11,0.15); padding: 4px 10px; border-radius: 4px; font-weight: 500;">ê¸ˆì•¡ ê¸°ì¤€ V-</span>
            <span class="live-badge hidden" id="liveBadge">LIVE</span>
            <span class="update-badge" id="updateDate">-</span>
        </div>
    </div>

    <!-- ê³ ì • í”Œë¡œíŒ… ì—…ë¡œë“œ ë²„íŠ¼ -->
    <div class="upload-floating">
        <button class="upload-floating-btn" onclick="openUploadModal()">íŒŒì¼ ì—…ë¡œë“œ</button>
    </div>

    <div class="container">
        <div id="emptyState" class="empty-state">
            <div class="empty-state-icon">ğŸ“Š</div>
            <div class="empty-state-text">ë¯¸ìˆ˜ê¸ˆ í˜„í™© ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
            <button class="btn btn-primary" onclick="openUploadModal()">ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</button>
        </div>

        <div id="dashboard" class="hidden">

            <!-- 1. ìš”ì•½ ì§€í‘œ (í•µì‹¬ 5ê°œ) - ìˆœì„œ: ìˆ˜ê¸ˆì˜ˆì •ì•¡ > ê´€ë¦¬ë¯¸ìˆ˜ê¸ˆ > ì¥ê¸°ë¯¸ìˆ˜ > ì˜ˆì™¸ì²˜ë¦¬ > íšŒì‹ ëŒ€ê¸° í˜„ì¥ -->
            <div class="summary-grid">
                <div class="stat-card">
                    <div class="stat-label">
                        <span class="stat-label-left">
                            ìˆ˜ê¸ˆì˜ˆì •ì•¡
                            <span class="tooltip-icon">?
                                <span class="tooltip-text">ì²­êµ¬ í›„ ë¯¸ì…ê¸ˆ ìƒíƒœì¸ ì „ì²´ ê¸ˆì•¡ í•©ê³„</span>
                            </span>
                        </span>
                        <span class="stat-change hidden" id="totalChange"></span>
                    </div>
                    <div class="stat-value" id="totalAmount">-</div>
                    <div class="stat-sub" id="totalCount">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <span class="stat-label-left">
                            ê´€ë¦¬ë¯¸ìˆ˜ê¸ˆ
                            <span class="tooltip-icon">?
                                <span class="tooltip-text" style="text-align:left;">
                                    <div style="font-weight:600; margin-bottom:6px;">ê´€ë¦¬ë¯¸ìˆ˜ê¸ˆ ê¸°ì¤€</div>
                                    <div style="color:#95a5a6; font-size:11px; margin-bottom:6px;">ë§¤ì¶œì¼ ê¸°ì¤€</div>
                                    <table style="width:100%; border-collapse:collapse; font-size:12px;">
                                        <tr><td style="padding:3px 8px 3px 0; color:#64748b;">ìì¬íŒë§¤</td><td style="padding:3px 0; font-weight:600;">40ì¼ ê²½ê³¼ì‹œ</td></tr>
                                        <tr><td style="padding:3px 8px 3px 0; color:#64748b;">ì„ ê¸‰ê¸ˆ</td><td style="padding:3px 0; font-weight:600;">20ì¼ ê²½ê³¼ì‹œ</td></tr>
                                        <tr><td style="padding:3px 8px 3px 0; color:#64748b;">ê·¸ ì™¸</td><td style="padding:3px 0; font-weight:600;">30ì¼ ê²½ê³¼ì‹œ</td></tr>
                                    </table>
                                </span>
                            </span>
                        </span>
                        <span class="stat-change hidden" id="manageChange"></span>
                    </div>
                    <div style="display: flex; align-items: flex-end; gap: 14px;">
                        <div style="flex-shrink: 0;">
                            <div class="stat-value" id="manageAmount">-</div>
                            <div class="stat-sub" id="manageCount">-</div>
                        </div>
                        <div style="display: flex; gap: 10px; padding-left: 14px; border-left: 1px dashed #e0e4e8; margin-bottom: 2px;">
                            <div>
                                <div style="font-size: 10px; color: #95a5a6; margin-bottom: 1px;">~25ë…„</div>
                                <div style="font-size: 13px; font-weight: 600; color: #c0392b;" id="manageBefore26">-</div>
                                <div style="font-size: 9px; color: #95a5a6;" id="manageBefore26Count">-</div>
                            </div>
                            <div>
                                <div style="font-size: 10px; color: #95a5a6; margin-bottom: 1px;">26ë…„</div>
                                <div style="font-size: 13px; font-weight: 600; color: #2874a6;" id="manage26">-</div>
                                <div style="font-size: 9px; color: #95a5a6;" id="manage26Count">-</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <span class="stat-label-left">
                            ì¥ê¸°ë¯¸ìˆ˜ê¸ˆ
                            <span class="tooltip-icon">?
                                <span class="tooltip-text" style="text-align:left;">
                                    <div style="font-weight:600; margin-bottom:6px;">ì¥ê¸°ë¯¸ìˆ˜ê¸ˆ ê¸°ì¤€</div>
                                    <div style="color:#95a5a6; font-size:11px; margin-bottom:6px;">ë§¤ì¶œì¼ ê¸°ì¤€</div>
                                    <div style="font-size:12px; font-weight:600;">91ì¼ ê²½ê³¼ ì‹œ</div>
                                </span>
                            </span>
                        </span>
                    </div>
                    <div class="stat-value" id="overdueAmount">-</div>
                    <div class="stat-sub" id="overdueDetail">-</div>
                </div>
                <div class="stat-card clickable" onclick="showExceptionList()">
                    <div class="stat-label">
                        <span class="stat-label-left">
                            ì˜ˆì™¸ ì²˜ë¦¬
                            <span class="tooltip-icon">?
                                <span class="tooltip-text">ë¶„ìŸÂ·ê³„ì•½ë³€ê²½ ë“± íŠ¹ìˆ˜ ì‚¬ìœ ë¡œ ë³„ë„ ë¶„ë¥˜ëœ ê±´</span>
                            </span>
                        </span>
                    </div>
                    <div class="stat-value" id="exceptionCount">-</div>
                    <div class="stat-sub" id="exceptionAmount">-</div>
                </div>
                <div class="stat-card clickable" onclick="showNoCommList()">
                    <div class="stat-label">
                        <span class="stat-label-left">
                            íšŒì‹ ëŒ€ê¸° í˜„ì¥
                            <span class="tooltip-icon">?
                                <span class="tooltip-text">ì…ê¸ˆ ì˜ˆì •ì¼ ë¯¸í™•ë³´ í˜„ì¥</span>
                            </span>
                        </span>
                    </div>
                    <div class="stat-value" id="noCommCount">-</div>
                    <div class="stat-sub" id="noCommAmount">-</div>
                </div>
            </div>

            <!-- 2. íŠ¸ë™ë³„ í˜„í™© -->
            <div class="track-grid">
                <div class="track-card">
                    <div class="track-header">
                        <div class="track-header-left">
                            <span class="track-name">ì»¨ì„¤íŒ…</span>
                        </div>
                        <div class="track-header-right">
                            <span class="track-count" id="trackACount">-</span>
                            <div class="toggle-group-sm">
                                <span>ì˜ˆì™¸ì œì™¸</span>
                                <label class="toggle-switch-sm">
                                    <input type="checkbox" id="trackAExcludeToggle" onchange="renderTrackCard('A')">
                                    <span class="toggle-slider-sm"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="track-stage-info" id="trackAStageInfo">ê¸°í•œë‚´: ì„ ê¸‰ê¸ˆ ~20ì¼ / ì¤‘ë„ê¸ˆÂ·ì”ê¸ˆ ~30ì¼ | ê´€ë¦¬: 21/31~90ì¼ | ì¥ê¸°ë¯¸ìˆ˜: 91ì¼~</div>
                    <div class="track-total" id="trackATotal">-</div>
                    <div class="stage-bar" id="trackABar"></div>
                    <div class="stage-detail">
                        <div class="stage-item normal">
                            <div class="stage-item-label">ê¸°í•œë‚´</div>
                            <div class="stage-item-value" id="trackANormal">-</div>
                            <div class="stage-item-sub" id="trackANormalPct">-</div>
                        </div>
                        <div class="stage-item manage">
                            <div class="stage-item-label">ê´€ë¦¬</div>
                            <div class="stage-item-value" id="trackAManage">-</div>
                            <div class="stage-item-sub" id="trackAManagePct">-</div>
                        </div>
                        <div class="stage-item overdue">
                            <div class="stage-item-label">ì¥ê¸°ë¯¸ìˆ˜</div>
                            <div class="stage-item-value" id="trackAOverdue">-</div>
                            <div class="stage-item-sub" id="trackAOverduePct">-</div>
                        </div>
                    </div>
                </div>

                <div class="track-card">
                    <div class="track-header">
                        <div class="track-header-left">
                            <span class="track-name">ìì¬íŒë§¤</span>
                        </div>
                        <div class="track-header-right">
                            <span class="track-count" id="trackBCount">-</span>
                            <div class="toggle-group-sm">
                                <span>ì˜ˆì™¸ì œì™¸</span>
                                <label class="toggle-switch-sm">
                                    <input type="checkbox" id="trackBExcludeToggle" onchange="renderTrackCard('B')">
                                    <span class="toggle-slider-sm"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="track-stage-info" id="trackBStageInfo">ê¸°í•œë‚´: ~40ì¼ | ê´€ë¦¬: 41~90ì¼ | ì¥ê¸°ë¯¸ìˆ˜: 91ì¼~</div>
                    <div class="track-total" id="trackBTotal">-</div>
                    <div class="stage-bar" id="trackBBar"></div>
                    <div class="stage-detail">
                        <div class="stage-item normal">
                            <div class="stage-item-label">ê¸°í•œë‚´</div>
                            <div class="stage-item-value" id="trackBNormal">-</div>
                            <div class="stage-item-sub" id="trackBNormalPct">-</div>
                        </div>
                        <div class="stage-item manage">
                            <div class="stage-item-label">ê´€ë¦¬</div>
                            <div class="stage-item-value" id="trackBManage">-</div>
                            <div class="stage-item-sub" id="trackBManagePct">-</div>
                        </div>
                        <div class="stage-item overdue">
                            <div class="stage-item-label">ì¥ê¸°ë¯¸ìˆ˜</div>
                            <div class="stage-item-value" id="trackBOverdue">-</div>
                            <div class="stage-item-sub" id="trackBOverduePct">-</div>
                        </div>
                    </div>
                </div>

                <div class="track-card">
                    <div class="track-header">
                        <div class="track-header-left">
                            <span class="track-name">íŠ¹í—ˆê¸°ìˆ ìë¬¸ë£Œ</span>
                        </div>
                        <div class="track-header-right">
                            <span class="track-count" id="trackCCount">-</span>
                            <div class="toggle-group-sm">
                                <span>ì˜ˆì™¸ì œì™¸</span>
                                <label class="toggle-switch-sm">
                                    <input type="checkbox" id="trackCExcludeToggle" onchange="renderTrackCard('C')">
                                    <span class="toggle-slider-sm"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="track-stage-info" id="trackCStageInfo">ê¸°í•œë‚´: ~30ì¼ | ê´€ë¦¬: 31~90ì¼ | ì¥ê¸°ë¯¸ìˆ˜: 91ì¼~</div>
                    <div class="track-total" id="trackCTotal">-</div>
                    <div class="stage-bar" id="trackCBar"></div>
                    <div class="stage-detail">
                        <div class="stage-item normal">
                            <div class="stage-item-label">ê¸°í•œë‚´</div>
                            <div class="stage-item-value" id="trackCNormal">-</div>
                            <div class="stage-item-sub" id="trackCNormalPct">-</div>
                        </div>
                        <div class="stage-item manage">
                            <div class="stage-item-label">ê´€ë¦¬</div>
                            <div class="stage-item-value" id="trackCManage">-</div>
                            <div class="stage-item-sub" id="trackCManagePct">-</div>
                        </div>
                        <div class="stage-item overdue">
                            <div class="stage-item-label">ì¥ê¸°ë¯¸ìˆ˜</div>
                            <div class="stage-item-value" id="trackCOverdue">-</div>
                            <div class="stage-item-sub" id="trackCOverduePct">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. ê²½ê³¼ì¼ êµ¬ê°„ë³„ ë¶„í¬ -->
            <div class="card" style="margin-bottom: 16px;">
                <div class="card-header">
                    <div class="card-title">
                        ê²½ê³¼ì¼ êµ¬ê°„ë³„ ë¶„í¬
                        <span class="tooltip-icon">?
                            <span class="tooltip-text">ê³„ì‚°ì„œ ë°œí–‰ì¼ ê¸°ì¤€ ê²½ê³¼ì¼ë³„ ë¯¸ìˆ˜ê¸ˆ ë¶„í¬</span>
                        </span>
                    </div>
                    <div class="toggle-group">
                        <span>ì˜ˆì™¸ ì œì™¸</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="distExcludeException" onchange="renderDistribution()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="distribution-bar" id="distributionBar"></div>
                <div class="distribution-legend" id="distributionLegend"></div>
            </div>

            <!-- 4. ì•¡ì…˜ í•„ìš” ì„¹ì…˜ -->
            <div class="grid-2" style="margin-bottom: 16px;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            ê¸ˆì£¼ ì•¡ì…˜ í•„ìš”
                            <span class="count-badge" id="actionCount">0</span>
                            <span class="tooltip-icon">?
                                <span class="tooltip-text">ê´€ë¦¬ ì§„ì… ë˜ëŠ” ì¥ê¸°ë¯¸ìˆ˜ ì „í™˜ ì„ë°• ê±´</span>
                            </span>
                        </div>
                    </div>
                    <div style="display:flex; justify-content:flex-end; align-items:center; margin-bottom:8px; padding-bottom:8px; border-bottom:1px solid var(--border);">
                        <div class="mini-tabs" id="actionTabs" style="margin:0; border:none; padding:0;">
                            <button class="mini-tab active" onclick="setActionTab('')">ì „ì²´</button>
                            <button class="mini-tab" onclick="setActionTab('A')">ì»¨ì„¤íŒ…</button>
                            <button class="mini-tab" onclick="setActionTab('B')">ìì¬</button>
                            <button class="mini-tab" onclick="setActionTab('C')">íŠ¹í—ˆë£Œ</button>
                        </div>
                    </div>
                    <div class="action-list" id="actionList"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            ì˜ˆìƒì…ê¸ˆì¼ ë„ë˜/ê²½ê³¼
                            <span class="count-badge" id="dueCount">0</span>
                            <span class="tooltip-icon">?
                                <span class="tooltip-text">ì…ê¸ˆ ì˜ˆì •ì¼ 7ì¼ ì´ë‚´ ë„ë˜ ë˜ëŠ” ì´ë¯¸ ê²½ê³¼í•œ ê±´</span>
                            </span>
                        </div>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; padding-bottom:8px; border-bottom:1px solid var(--border);">
                        <div class="mini-tabs" id="dueStatusTabs" style="margin:0; border:none; padding:0;">
                            <button class="mini-tab active" onclick="setDueStatusTab('all')">ì „ì²´</button>
                            <button class="mini-tab" onclick="setDueStatusTab('upcoming')">ë„ë˜ ì˜ˆì •</button>
                            <button class="mini-tab" onclick="setDueStatusTab('overdue')">ê²½ê³¼</button>
                        </div>
                        <div class="mini-tabs" id="dueTabs" style="margin:0; border:none; padding:0;">
                            <button class="mini-tab active" onclick="setDueTab('A')">ì»¨ì„¤íŒ…</button>
                            <button class="mini-tab" onclick="setDueTab('B')">ìì¬</button>
                            <button class="mini-tab" onclick="setDueTab('C')">íŠ¹í—ˆë£Œ</button>
                        </div>
                    </div>
                    <div class="action-list" id="dueList"></div>
                </div>
            </div>

            <!-- 5. ìƒìœ„ í˜„ì¥/ì—…ì²´ ìˆœìœ„ (3ë¶„í• ) -->
            <div style="margin-bottom: 16px;">
                <div class="grid-3">
                    <div class="card" style="margin-bottom:0;">
                        <div class="card-header" style="display:flex; justify-content:space-between; align-items:center;">
                            <div class="card-title">ë¯¸ìˆ˜ê¸ˆ ìƒìœ„ í˜„ì¥</div>
                            <div class="rank-sort-toggle">
                                <button class="rank-sort-btn active" data-card="site" data-sort="amount" onclick="setRankSort('site','amount')">ê¸ˆì•¡</button>
                                <button class="rank-sort-btn" data-card="site" data-sort="days" onclick="setRankSort('site','days')">ê²½ê³¼ì¼</button>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                            <div class="mini-tabs rank-track-tabs" id="rankSiteTabs" style="margin:0; border:none; padding:0;">
                                <button class="mini-tab" onclick="setRankCardTab('site','A')">ì»¨ì„¤íŒ…</button>
                                <button class="mini-tab" onclick="setRankCardTab('site','B')">ìì¬</button>
                                <button class="mini-tab" onclick="setRankCardTab('site','C')">íŠ¹í—ˆë£Œ</button>
                            </div>
                            <div class="toggle-group-sm">
                                <span>ì˜ˆì™¸ì œì™¸</span>
                                <label class="toggle-switch-sm">
                                    <input type="checkbox" id="rankSiteExcludeException" onchange="renderTopSite()">
                                    <span class="toggle-slider-sm"></span>
                                </label>
                            </div>
                        </div>
                        <div class="rank-list" id="topSiteList"></div>
                    </div>
                    <div class="card" style="margin-bottom:0;">
                        <div class="card-header" style="display:flex; justify-content:space-between; align-items:center;">
                            <div class="card-title">ë¯¸ìˆ˜ê¸ˆ ìƒìœ„ ì—…ì²´</div>
                            <div class="rank-sort-toggle">
                                <button class="rank-sort-btn active" data-card="amount" data-sort="amount" onclick="setRankSort('amount','amount')">ê¸ˆì•¡</button>
                                <button class="rank-sort-btn" data-card="amount" data-sort="days" onclick="setRankSort('amount','days')">ê²½ê³¼ì¼</button>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                            <div class="mini-tabs rank-track-tabs" id="rankAmountTabs" style="margin:0; border:none; padding:0;">
                                <button class="mini-tab" onclick="setRankCardTab('amount','A')">ì»¨ì„¤íŒ…</button>
                                <button class="mini-tab" onclick="setRankCardTab('amount','B')">ìì¬</button>
                                <button class="mini-tab" onclick="setRankCardTab('amount','C')">íŠ¹í—ˆë£Œ</button>
                            </div>
                            <div class="toggle-group-sm">
                                <span>ì˜ˆì™¸ì œì™¸</span>
                                <label class="toggle-switch-sm">
                                    <input type="checkbox" id="rankAmountExcludeException" onchange="renderTopAmount()">
                                    <span class="toggle-slider-sm"></span>
                                </label>
                            </div>
                        </div>
                        <div class="rank-list" id="topAmountList"></div>
                    </div>
                    <div class="card" style="margin-bottom:0;">
                        <div class="card-header" style="display:flex; justify-content:space-between; align-items:center;">
                            <div class="card-title">ê²½ê³¼ì¼ ìƒìœ„ ì—…ì²´</div>
                            <div class="rank-sort-toggle">
                                <button class="rank-sort-btn" data-card="days" data-sort="amount" onclick="setRankSort('days','amount')">ê¸ˆì•¡</button>
                                <button class="rank-sort-btn active" data-card="days" data-sort="days" onclick="setRankSort('days','days')">ê²½ê³¼ì¼</button>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                            <div class="mini-tabs rank-track-tabs" id="rankDaysTabs" style="margin:0; border:none; padding:0;">
                                <button class="mini-tab" onclick="setRankCardTab('days','A')">ì»¨ì„¤íŒ…</button>
                                <button class="mini-tab" onclick="setRankCardTab('days','B')">ìì¬</button>
                                <button class="mini-tab" onclick="setRankCardTab('days','C')">íŠ¹í—ˆë£Œ</button>
                            </div>
                            <div class="toggle-group-sm">
                                <span>ì˜ˆì™¸ì œì™¸</span>
                                <label class="toggle-switch-sm">
                                    <input type="checkbox" id="rankDaysExcludeException" onchange="renderTopDays()">
                                    <span class="toggle-slider-sm"></span>
                                </label>
                            </div>
                        </div>
                        <div class="rank-list" id="topDaysList"></div>
                    </div>
                </div>
            </div>

            <!-- 6. ìƒì„¸ ëª©ë¡ -->
            <div class="card">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-track="" onclick="setDetailTab('')">ì „ì²´</button>
                    <button class="tab-btn" data-track="A" onclick="setDetailTab('A')">ì»¨ì„¤íŒ…</button>
                    <button class="tab-btn" data-track="B" onclick="setDetailTab('B')">ìì¬íŒë§¤</button>
                    <button class="tab-btn" data-track="C" onclick="setDetailTab('C')">íŠ¹í—ˆê¸°ìˆ ìë¬¸ë£Œ</button>
                    <button class="btn btn-primary btn-sm" onclick="downloadExcel()" style="margin-left: auto;">ë‹¤ìš´ë¡œë“œ</button>
                </div>

                <div class="filter-bar">
                    <div class="filter-left">
                        <span style="font-size: 14px; font-weight: 600;" id="detailTitle">ì „ì²´ ìƒì„¸ ë‚´ì—­</span>
                    </div>
                    <div class="filter-right">
                        <select class="filter-select" id="filterStage" onchange="goToPage(1)">
                            <option value="">êµ¬ê°„</option>
                            <option value="ì¥ê¸°ë¯¸ìˆ˜">ì¥ê¸°ë¯¸ìˆ˜</option>
                            <option value="ê´€ë¦¬">ê´€ë¦¬</option>
                            <option value="ê¸°í•œë‚´">ê¸°í•œë‚´</option>
                        </select>
                        <select class="filter-select" id="filterException" onchange="goToPage(1)">
                            <option value="">ì˜ˆì™¸ì—¬ë¶€</option>
                            <option value="N">ì˜ˆì™¸ ì œì™¸</option>
                            <option value="Y">ì˜ˆì™¸ë§Œ</option>
                        </select>
                        <select class="filter-select" id="filterComm" onchange="goToPage(1)">
                            <option value="">ì˜ˆì •ì¼</option>
                            <option value="Y">ì…ê¸ˆì¼ í™•ë³´</option>
                            <option value="N">ì…ê¸ˆì¼ ë¯¸í™•ë³´</option>
                        </select>
                        <select class="filter-select" id="filterPaid" onchange="goToPage(1)">
                            <option value="unpaid">ë¯¸ìˆ˜ê¸ˆë§Œ</option>
                            <option value="paid">ì…ê¸ˆì™„ë£Œë§Œ</option>
                            <option value="">ì „ì²´(ì…ê¸ˆí¬í•¨)</option>
                        </select>
                        <input type="text" class="search-input" id="searchInput" placeholder="ì—…ì²´/í˜„ì¥ ê²€ìƒ‰..." oninput="goToPage(1)">
                        <button class="btn btn-outline btn-sm" onclick="resetFilters()">ì´ˆê¸°í™”</button>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="data-table" id="detailTable">
                        <thead>
                            <tr>
                                <th onclick="setSortColumn('ìˆœë²ˆ')">ìˆœë²ˆ <span class="sort-icon">â†•</span></th>
                                <th onclick="setSortColumn('ì—…ì²´ëª…')">ì—…ì²´ëª… <span class="sort-icon">â†•</span></th>
                                <th onclick="setSortColumn('í˜„ì¥ëª…')">í˜„ì¥ëª… <span class="sort-icon">â†•</span></th>
                                <th onclick="setSortColumn('êµ¬ë¶„')">êµ¬ë¶„ <span class="sort-icon">â†•</span></th>
                                <th class="amount" onclick="setSortColumn('ë¯¸ìˆ˜ê¸ˆì•¡')">ë¯¸ìˆ˜ê¸ˆì•¡ <span class="sort-icon">â†•</span></th>
                                <th class="center" onclick="setSortColumn('ê²½ê³¼ì¼')">ê²½ê³¼ì¼ <span class="sort-icon">â†•</span></th>
                                <th class="center" onclick="setSortColumn('ë‹¨ê³„')">ë‹¨ê³„ <span class="sort-icon">â†•</span></th>
                                <th onclick="setSortColumn('ì˜ˆìƒì…ê¸ˆì¼')">ì˜ˆìƒì…ê¸ˆì¼ <span class="sort-icon">â†•</span></th>
                                <th onclick="setSortColumn('ì…ê¸ˆì¼')">ì…ê¸ˆì¼ <span class="sort-icon">â†•</span></th>
                                <th class="center">ì˜ˆì™¸</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="pagination" id="pagination"></div>
            </div>

        </div>
    </div>

    <!-- ì—…ë¡œë“œ ëª¨ë‹¬ -->
    <div class="modal" id="uploadModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</h3>
                <button class="close-btn" onclick="closeUploadModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">í´ë¦­í•˜ì—¬ íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜<br>ì—¬ê¸°ë¡œ íŒŒì¼ì„ ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”</div>
                    <div style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">.xlsx, .xls íŒŒì¼ë§Œ ì§€ì›</div>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" onchange="loadExcel(event)">
                </div>
            </div>
        </div>
    </div>

    <!-- ì—…ì²´ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal" id="companyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="companyModalTitle">ì—…ì²´ ìƒì„¸</h3>
                <button class="close-btn" onclick="closeCompanyModal()">Ã—</button>
            </div>
            <div class="modal-body" id="companyModalBody"></div>
        </div>
    </div>

    <script>
        let rawData = [];
        let previousData = null;
        let originalFileBuffer = null;  // ì—…ë¡œë“œí•œ ì›ë³¸ ì—‘ì…€ íŒŒì¼ ë³´ê´€
        let originalFileName = '';      // ì›ë³¸ íŒŒì¼ëª… ë³´ê´€
        let originalHeaderRowIdx = 0;   // ì›ë³¸ ì—‘ì…€ì˜ í—¤ë” í–‰ ì¸ë±ìŠ¤ (0-based)
        let currentTrack = '';
        let currentPage = 1;
        let sortColumn = 'ê²½ê³¼ì¼';
        let sortDirection = 'desc';
        const itemsPerPage = 10;

        // ê° ì„¹ì…˜ë³„ íƒ­ ìƒíƒœ
        let actionTabTrack = '';
        let dueTabTrack = '';
        let rankTrackSite = '';     // individual track filter per card
        let rankTrackAmount = '';
        let rankTrackDays = '';
        let rankSortSite = 'amount';    // 'amount' or 'days'
        let rankSortAmount = 'amount';  // 'amount' or 'days'
        let rankSortDays = 'days';      // 'amount' or 'days'
        let dueStatusFilter = 'all'; // 'all', 'upcoming', 'overdue'

        // ë‹¨ê³„ í‘œì‹œëª… ë§¤í•‘ (ë‚´ë¶€ê°’ -> í‘œì‹œê°’)
        const stageDisplayName = { 'ì •ìƒ': 'ê¸°í•œë‚´', 'ê´€ë¦¬': 'ê´€ë¦¬', 'ì—°ì²´': 'ì¥ê¸°ë¯¸ìˆ˜' };
        // í‘œì‹œê°’ -> ë‚´ë¶€ê°’ ì—­ë§¤í•‘
        const stageInternalName = { 'ê¸°í•œë‚´': 'ì •ìƒ', 'ê´€ë¦¬': 'ê´€ë¦¬', 'ì¥ê¸°ë¯¸ìˆ˜': 'ì—°ì²´' };

        function openUploadModal() { document.getElementById('uploadModal').classList.add('active'); }
        function closeUploadModal() { document.getElementById('uploadModal').classList.remove('active'); }
        function closeCompanyModal() { document.getElementById('companyModal').classList.remove('active'); }

        function loadExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            // ì›ë³¸ íŒŒì¼ëª… ì €ì¥
            originalFileName = file.name;

            const reader = new FileReader();
            reader.onload = function(e) {
                // ì›ë³¸ íŒŒì¼ ë°”ì´ë„ˆë¦¬ ê·¸ëŒ€ë¡œ ë³´ê´€
                originalFileBuffer = e.target.result.slice(0);
                processExcelData(e.target.result);
                closeUploadModal();
            };
            reader.readAsArrayBuffer(file);
        }

        // ì—‘ì…€ ì‹œë¦¬ì–¼ ë„˜ë²„ â†’ yyyy-mm-dd ë³€í™˜ (íƒ€ì„ì¡´ ë¬´ê´€, ìˆœìˆ˜ ì‚°ìˆ )
        function excelSerialToDate(serial) {
            // ì—‘ì…€ ê¸°ì¤€: 1900-01-01 = 1, 1900ë…„ ìœ¤ë…„ ë²„ê·¸(60) ë³´ì •
            let s = Math.round(serial);
            if (s > 60) s--; // ì—‘ì…€ 1900 ìœ¤ë…„ ë²„ê·¸ ë³´ì •
            s--; // 1-based â†’ 0-based
            const base = new Date(1900, 0, 1);
            base.setDate(base.getDate() + s);
            const y = base.getFullYear();
            const m = String(base.getMonth() + 1).padStart(2, '0');
            const dd = String(base.getDate()).padStart(2, '0');
            return y + '-' + m + '-' + dd;
        }
        // ë‹¤ì–‘í•œ í˜•ì‹ì˜ ë‚ ì§œë¥¼ yyyy-mm-dd ë¬¸ìì—´ë¡œ ì •ê·œí™”
        function normalizeDate(d) {
            if (!d) return null;
            // ì´ë¯¸ yyyy-mm-dd ë¬¸ìì—´ì´ë©´ ê·¸ëŒ€ë¡œ
            if (typeof d === 'string' && /^\d{4}-\d{2}-\d{2}/.test(d)) return d.substring(0, 10);
            // ì—‘ì…€ ì‹œë¦¬ì–¼ ë„˜ë²„ (ìˆ«ì)
            if (typeof d === 'number') return excelSerialToDate(d);
            // ISO ë¬¸ìì—´ (ê¸°ì¡´ localStorageì— ì €ì¥ëœ ë°ì´í„°) â†’ í•˜ë£¨ ë°€ë¦¼ ë³´ì •
            if (typeof d === 'string' && d.includes('T')) {
                const dt = new Date(d);
                // XLSX.js cellDates:true ë²„ê·¸ë¡œ UTC ì‹œê°„ì´ ë¶™ì–´ìˆìœ¼ë©´ í•˜ë£¨ ì¶”ê°€
                if (dt.getUTCHours() > 0) {
                    dt.setUTCDate(dt.getUTCDate() + 1);
                }
                const y = dt.getUTCFullYear();
                const m = String(dt.getUTCMonth() + 1).padStart(2, '0');
                const dd = String(dt.getUTCDate()).padStart(2, '0');
                return y + '-' + m + '-' + dd;
            }
            return null;
        }
        function todayStr() {
            const n = new Date();
            return n.getFullYear() + '-' + String(n.getMonth()+1).padStart(2,'0') + '-' + String(n.getDate()).padStart(2,'0');
        }
        function diffDaysFromStr(dateStr1, dateStr2) {
            // ìˆœìˆ˜ ë‚ ì§œ ë¬¸ìì—´ë¼ë¦¬ ë¹„êµ (íƒ€ì„ì¡´ ë¬´ê´€)
            const d1 = new Date(dateStr1 + 'T00:00:00');
            const d2 = new Date(dateStr2 + 'T00:00:00');
            return Math.round((d1 - d2) / (1000 * 60 * 60 * 24));
        }

        function processExcelData(arrayBuffer) {
            try {
                const prevUnpaid = rawData.filter(r => !r['ì…ê¸ˆì¼']);
                previousData = prevUnpaid.length > 0 ? {
                    total: prevUnpaid.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0),
                    manage: prevUnpaid.filter(r => r['ë‹¨ê³„'] === 'ê´€ë¦¬' || r['ë‹¨ê³„'] === 'ì—°ì²´').reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0)
                } : null;

                const data = new Uint8Array(arrayBuffer);
                const workbook = XLSX.read(data, { type: 'array' });

                const sheetName = workbook.SheetNames.find(n => n === 'ì „ì²´') || workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];
                const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                const headerRow = json.findIndex(row => row && (row.includes('ìˆœë²ˆ') || row.includes('ì—…ì²´ëª…')));
                if (headerRow < 0) { alert('ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.'); return; }
                originalHeaderRowIdx = headerRow;

                const headers = json[headerRow];
                rawData = [];

                for (let i = headerRow + 1; i < json.length; i++) {
                    const row = json[i];
                    if (!row) continue;

                    const obj = {};
                    headers.forEach((h, idx) => { if (h) obj[h] = row[idx]; });
                    if (!obj['ì—…ì²´ëª…']) continue;
                    obj['_originalRowIdx'] = i; // ì›ë³¸ ì—‘ì…€ í–‰ ë²ˆí˜¸ (0-based, json ë°°ì—´ ì¸ë±ìŠ¤)

                    const gubun = obj['êµ¬ë¶„'] || '';
                    if (['ì„ ê¸‰ê¸ˆ', 'ì¤‘ë„ê¸ˆ', 'ì”ê¸ˆ'].includes(gubun)) obj['íŠ¸ë™'] = 'A';
                    else if (gubun === 'ìì¬') obj['íŠ¸ë™'] = 'B';
                    else if (gubun === 'íŠ¹í—ˆë£Œ') obj['íŠ¸ë™'] = 'C';

                    // ë‚ ì§œ í•„ë“œë¥¼ yyyy-mm-dd ë¬¸ìì—´ë¡œ ì •ê·œí™” (íƒ€ì„ì¡´ ë¬¸ì œ ë°©ì§€)
                    if (obj['ê³„ì‚°ì„œë°œí–‰ì¼']) obj['ê³„ì‚°ì„œë°œí–‰ì¼'] = normalizeDate(obj['ê³„ì‚°ì„œë°œí–‰ì¼']);
                    if (obj['ì˜ˆìƒì…ê¸ˆì¼']) obj['ì˜ˆìƒì…ê¸ˆì¼'] = normalizeDate(obj['ì˜ˆìƒì…ê¸ˆì¼']);
                    if (obj['ì˜ˆì •ì…ê¸ˆì¼']) obj['ì˜ˆì •ì…ê¸ˆì¼'] = normalizeDate(obj['ì˜ˆì •ì…ê¸ˆì¼']);
                    if (obj['ì…ê¸ˆì¼']) obj['ì…ê¸ˆì¼'] = normalizeDate(obj['ì…ê¸ˆì¼']);

                    // ê²½ê³¼ì¼ ê³„ì‚°: ì…ê¸ˆì¼ì´ ìˆìœ¼ë©´ ì…ê¸ˆì¼-ë°œí–‰ì¼, ì—†ìœ¼ë©´ ì˜¤ëŠ˜-ë°œí–‰ì¼
                    if (obj['ê³„ì‚°ì„œë°œí–‰ì¼']) {
                        if (obj['ì…ê¸ˆì¼']) {
                            obj['ê²½ê³¼ì¼'] = diffDaysFromStr(obj['ì…ê¸ˆì¼'], obj['ê³„ì‚°ì„œë°œí–‰ì¼']);
                        } else {
                            obj['ê²½ê³¼ì¼'] = diffDaysFromStr(todayStr(), obj['ê³„ì‚°ì„œë°œí–‰ì¼']);
                        }
                    } else { obj['ê²½ê³¼ì¼'] = 0; }

                    obj['ë‹¨ê³„'] = calculateStage(obj);
                    obj['ë¯¸ìˆ˜ê¸ˆì•¡'] = obj['ë¯¸ìˆ˜ê¸ˆì•¡(v-)'] || obj['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0;

                    rawData.push(obj);
                }

                document.getElementById('emptyState').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                const now = new Date();
                const y = now.getFullYear(), m = String(now.getMonth()+1).padStart(2,'0'), d = String(now.getDate()).padStart(2,'0');
                const hh = String(now.getHours()).padStart(2,'0'), mm = String(now.getMinutes()).padStart(2,'0');
                document.getElementById('updateDate').textContent = y + '-' + m + '-' + d + ' ' + hh + ':' + mm + ' ì—…ë°ì´íŠ¸';
                document.getElementById('liveBadge').classList.remove('hidden');

                // localStorageì— ë°ì´í„° ì €ì¥
                saveDataToStorage();

                renderDashboard();
            } catch (err) { console.error(err); alert('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜'); }
        }

        // localStorage ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
        function saveDataToStorage() {
            try {
                localStorage.setItem('dashboardRawData', JSON.stringify(rawData));
                localStorage.setItem('dashboardPreviousData', JSON.stringify(previousData));
                localStorage.setItem('dashboardUpdateDate', document.getElementById('updateDate').textContent);
                localStorage.setItem('dashboardHeaderRowIdx', originalHeaderRowIdx);
                // ì›ë³¸ ì—‘ì…€ íŒŒì¼ì„ Base64ë¡œ ì €ì¥
                if (originalFileBuffer) {
                    const bytes = new Uint8Array(originalFileBuffer);
                    let binary = '';
                    for (let i = 0; i < bytes.length; i++) binary += String.fromCharCode(bytes[i]);
                    localStorage.setItem('dashboardOriginalFile', btoa(binary));
                    localStorage.setItem('dashboardOriginalFileName', originalFileName);
                }
            } catch (e) { console.warn('localStorage ì €ì¥ ì‹¤íŒ¨:', e); }
        }

        function loadDataFromStorage() {
            try {
                const saved = localStorage.getItem('dashboardRawData');
                if (saved) {
                    rawData = JSON.parse(saved);

                    // ê¸°ì¡´ ì €ì¥ ë°ì´í„°ì˜ ë‚ ì§œ ì •ê·œí™” + ê²½ê³¼ì¼ ì¬ê³„ì‚°
                    const tStr = todayStr();
                    rawData.forEach(r => {
                        if (r['ê³„ì‚°ì„œë°œí–‰ì¼']) r['ê³„ì‚°ì„œë°œí–‰ì¼'] = normalizeDate(r['ê³„ì‚°ì„œë°œí–‰ì¼']);
                        if (r['ì˜ˆìƒì…ê¸ˆì¼']) r['ì˜ˆìƒì…ê¸ˆì¼'] = normalizeDate(r['ì˜ˆìƒì…ê¸ˆì¼']);
                        if (r['ì˜ˆì •ì…ê¸ˆì¼']) r['ì˜ˆì •ì…ê¸ˆì¼'] = normalizeDate(r['ì˜ˆì •ì…ê¸ˆì¼']);
                        if (r['ì…ê¸ˆì¼']) r['ì…ê¸ˆì¼'] = normalizeDate(r['ì…ê¸ˆì¼']);
                        if (r['ê³„ì‚°ì„œë°œí–‰ì¼']) {
                            if (r['ì…ê¸ˆì¼']) {
                                r['ê²½ê³¼ì¼'] = diffDaysFromStr(r['ì…ê¸ˆì¼'], r['ê³„ì‚°ì„œë°œí–‰ì¼']);
                            } else {
                                r['ê²½ê³¼ì¼'] = diffDaysFromStr(tStr, r['ê³„ì‚°ì„œë°œí–‰ì¼']);
                            }
                        }
                        r['ë‹¨ê³„'] = calculateStage(r);
                    });

                    const prevSaved = localStorage.getItem('dashboardPreviousData');
                    if (prevSaved) previousData = JSON.parse(prevSaved);
                    const dateStr = localStorage.getItem('dashboardUpdateDate');
                    if (dateStr) document.getElementById('updateDate').textContent = dateStr;

                    // ì›ë³¸ ì—‘ì…€ íŒŒì¼ ë³µì›
                    const savedFile = localStorage.getItem('dashboardOriginalFile');
                    if (savedFile) {
                        const binary = atob(savedFile);
                        const bytes = new Uint8Array(binary.length);
                        for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
                        originalFileBuffer = bytes.buffer;
                        originalFileName = localStorage.getItem('dashboardOriginalFileName') || 'ë¯¸ìˆ˜ê¸ˆ_ëŒ€ì‹œë³´ë“œ.xlsx';
                    }
                    const savedHeaderIdx = localStorage.getItem('dashboardHeaderRowIdx');
                    if (savedHeaderIdx !== null) originalHeaderRowIdx = parseInt(savedHeaderIdx);

                    document.getElementById('emptyState').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    document.getElementById('liveBadge').classList.remove('hidden');
                    renderDashboard();

                    // ì •ê·œí™”ëœ ë°ì´í„°ë¡œ ë‹¤ì‹œ ì €ì¥
                    saveDataToStorage();
                    return true;
                }
            } catch (e) { console.warn('localStorage ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e); }
            return false;
        }

        function calculateStage(row) {
            const track = row['íŠ¸ë™'], days = row['ê²½ê³¼ì¼'] || 0, gubun = row['êµ¬ë¶„'];

            if (track === 'A') {
                // ì»¨ì„¤íŒ…: ì„ ê¸‰ê¸ˆ ~20ì¼ ì •ìƒ, 21~90 ê´€ë¦¬, 91~ ì¥ê¸°ë¯¸ìˆ˜
                //         ì¤‘ë„ê¸ˆ/ì”ê¸ˆ ~30ì¼ ì •ìƒ, 31~90 ê´€ë¦¬, 91~ ì¥ê¸°ë¯¸ìˆ˜
                if (gubun === 'ì„ ê¸‰ê¸ˆ') return days <= 20 ? 'ì •ìƒ' : days <= 90 ? 'ê´€ë¦¬' : 'ì—°ì²´';
                return days <= 30 ? 'ì •ìƒ' : days <= 90 ? 'ê´€ë¦¬' : 'ì—°ì²´';
            }
            if (track === 'B') {
                // ìì¬: ~40ì¼ ì •ìƒ, 41~90 ê´€ë¦¬, 91~ ì¥ê¸°ë¯¸ìˆ˜
                return days <= 40 ? 'ì •ìƒ' : days <= 90 ? 'ê´€ë¦¬' : 'ì—°ì²´';
            }
            if (track === 'C') {
                // íŠ¹í—ˆë£Œ: ~30ì¼ ì •ìƒ, 31~90 ê´€ë¦¬, 91~ ì¥ê¸°ë¯¸ìˆ˜
                return days <= 30 ? 'ì •ìƒ' : days <= 90 ? 'ê´€ë¦¬' : 'ì—°ì²´';
            }
            return days <= 30 ? 'ì •ìƒ' : days <= 90 ? 'ê´€ë¦¬' : 'ì—°ì²´';
        }

        function formatAmount(num) {
            if (!num) return '-';
            if (num >= 100000000) return (num / 100000000).toFixed(1) + 'ì–µ';
            if (num >= 10000000) return (num / 10000000).toFixed(1) + 'ì²œë§Œ';
            if (num >= 10000) return Math.round(num / 10000).toLocaleString() + 'ë§Œ';
            return num.toLocaleString();
        }


        function formatFullAmount(num) { return num ? num.toLocaleString() + 'ì›' : '-'; }

        function getDisplayStage(internalStage) {
            return stageDisplayName[internalStage] || internalStage;
        }

        function getStageClass(internalStage) {
            if (internalStage === 'ì •ìƒ') return 'success';
            if (internalStage === 'ê´€ë¦¬') return 'warning';
            return 'danger';
        }

        function renderDashboard() {
            // ì…ê¸ˆì¼ì´ ì—†ëŠ” ê±´ë§Œ ë¯¸ìˆ˜ê¸ˆìœ¼ë¡œ ì§‘ê³„ (ì…ê¸ˆ ì™„ë£Œ ê±´ ì œì™¸)
            const unpaidData = rawData.filter(r => !r['ì…ê¸ˆì¼']);

            const total = unpaidData.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);
            const manageOverdueData = unpaidData.filter(r => r['ë‹¨ê³„'] === 'ê´€ë¦¬' || r['ë‹¨ê³„'] === 'ì—°ì²´');
            const manageOverdue = manageOverdueData.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);

            // ì¥ê¸°ë¯¸ìˆ˜ ë°ì´í„°
            const overdueData = unpaidData.filter(r => r['ë‹¨ê³„'] === 'ì—°ì²´');
            const overdueAmount = overdueData.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);

            // íšŒì‹ ëŒ€ê¸° í˜„ì¥ (ì˜ˆì™¸ ì œì™¸, ì…ê¸ˆì¼ ë¯¸í™•ë³´)
            const noComm = unpaidData.filter(r => r['ì˜ˆì™¸ì—¬ë¶€'] !== 'Y' && !r['ì˜ˆìƒì…ê¸ˆì¼'] && !r['ì˜ˆì •ì…ê¸ˆì¼']);
            const noCommAmount = noComm.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);

            // ì˜ˆì™¸ ì²˜ë¦¬ (ì…ê¸ˆ ì™„ë£Œ ê±´ ì œì™¸)
            const exceptionY = unpaidData.filter(r => r['ì˜ˆì™¸ì—¬ë¶€'] === 'Y');
            const exYAmount = exceptionY.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);

            // ë©”ì¸ ì§€í‘œ
            document.getElementById('totalAmount').textContent = formatAmount(total);
            document.getElementById('totalCount').textContent = unpaidData.length + 'ê±´';
            document.getElementById('manageAmount').textContent = formatAmount(manageOverdue);
            document.getElementById('manageCount').textContent = manageOverdueData.length + 'ê±´';

            // ê´€ë¦¬ë¯¸ìˆ˜ê¸ˆ ì—°ë„ë³„ ë¶„ë¦¬: ~25ë…„ / 26ë…„
            const manageBefore26 = manageOverdueData.filter(r => {
                const d = r['ê³„ì‚°ì„œë°œí–‰ì¼'];
                return d && d.substring(0, 4) < '2026';
            });
            const manage26 = manageOverdueData.filter(r => {
                const d = r['ê³„ì‚°ì„œë°œí–‰ì¼'];
                return d && d.substring(0, 4) >= '2026';
            });
            const manageBefore26Amount = manageBefore26.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);
            const manage26Amount = manage26.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);

            document.getElementById('manageBefore26').textContent = formatAmount(manageBefore26Amount);
            document.getElementById('manageBefore26Count').textContent = manageBefore26.length + 'ê±´';
            document.getElementById('manage26').textContent = formatAmount(manage26Amount);
            document.getElementById('manage26Count').textContent = manage26.length + 'ê±´';
            document.getElementById('overdueAmount').textContent = formatAmount(overdueAmount);
            document.getElementById('overdueDetail').textContent = `${overdueData.length}ê±´`;
            document.getElementById('noCommCount').textContent = noComm.length + 'ê±´';
            document.getElementById('noCommAmount').textContent = formatAmount(noCommAmount);
            document.getElementById('exceptionCount').textContent = formatAmount(exYAmount);
            document.getElementById('exceptionAmount').textContent = exceptionY.length + 'ê±´';

            // ì…ê¸ˆ ì™„ë£Œ ê±´ìˆ˜ í‘œì‹œ (ì „ì²´ ë°ì´í„° ì¤‘ ì…ê¸ˆ ì™„ë£Œ)
            const paidData = rawData.filter(r => r['ì…ê¸ˆì¼']);
            const paidCount = paidData.length;

            // ì „ì›” ëŒ€ë¹„ (ì´ì „ ë°ì´í„° ìˆìœ¼ë©´)
            if (previousData) {
                const totalChange = document.getElementById('totalChange');
                const manageChange = document.getElementById('manageChange');

                const totalDiff = total - previousData.total;
                const manageDiff = manageOverdue - previousData.manage;

                if (totalDiff !== 0) {
                    totalChange.textContent = (totalDiff > 0 ? 'â–² ' : 'â–¼ ') + formatAmount(Math.abs(totalDiff));
                    totalChange.className = 'stat-change ' + (totalDiff > 0 ? 'up' : 'down');
                    totalChange.classList.remove('hidden');
                }

                if (manageDiff !== 0) {
                    manageChange.textContent = (manageDiff > 0 ? 'â–² ' : 'â–¼ ') + formatAmount(Math.abs(manageDiff));
                    manageChange.className = 'stat-change ' + (manageDiff > 0 ? 'up' : 'down');
                    manageChange.classList.remove('hidden');
                }
            }

            renderTrackCard('A');
            renderTrackCard('B');
            renderTrackCard('C');
            renderDistribution();
            renderActionList();
            renderDueList();
            renderTopSite();
            renderTopAmount();
            renderTopDays();
            renderDetailTable();
        }

        function renderTrackCard(track) {
            const excludeToggle = document.getElementById(`track${track}ExcludeToggle`);
            const excludeException = excludeToggle ? excludeToggle.checked : false;

            // ì…ê¸ˆ ì™„ë£Œ ê±´ ì œì™¸
            let trackData = rawData.filter(r => r['íŠ¸ë™'] === track && !r['ì…ê¸ˆì¼']);
            if (excludeException) {
                trackData = trackData.filter(r => r['ì˜ˆì™¸ì—¬ë¶€'] !== 'Y');
            }

            const trackTotal = trackData.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);

            const stageData = {};
            ['ì •ìƒ', 'ê´€ë¦¬', 'ì—°ì²´'].forEach(stage => {
                const filtered = trackData.filter(r => r['ë‹¨ê³„'] === stage);
                stageData[stage] = { count: filtered.length, amount: filtered.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0) };
            });

            document.getElementById(`track${track}Count`).textContent = trackData.length + 'ê±´';
            document.getElementById(`track${track}Total`).textContent = formatFullAmount(trackTotal);

            document.getElementById(`track${track}Normal`).textContent = formatAmount(stageData['ì •ìƒ'].amount);
            document.getElementById(`track${track}Manage`).textContent = formatAmount(stageData['ê´€ë¦¬'].amount);
            document.getElementById(`track${track}Overdue`).textContent = formatAmount(stageData['ì—°ì²´'].amount);

            const normalPct = trackTotal > 0 ? ((stageData['ì •ìƒ'].amount / trackTotal) * 100).toFixed(0) : 0;
            const managePct = trackTotal > 0 ? ((stageData['ê´€ë¦¬'].amount / trackTotal) * 100).toFixed(0) : 0;
            const overduePct = trackTotal > 0 ? ((stageData['ì—°ì²´'].amount / trackTotal) * 100).toFixed(0) : 0;

            document.getElementById(`track${track}NormalPct`).textContent = `${stageData['ì •ìƒ'].count}ê±´ Â· ${normalPct}%`;
            document.getElementById(`track${track}ManagePct`).textContent = `${stageData['ê´€ë¦¬'].count}ê±´ Â· ${managePct}%`;
            document.getElementById(`track${track}OverduePct`).textContent = `${stageData['ì—°ì²´'].count}ê±´ Â· ${overduePct}%`;

            // íŠ¸ë™ë³„ êµ¬ê°„ ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸
            const stageInfoEl = document.getElementById(`track${track}StageInfo`);
            if (track === 'A') {
                stageInfoEl.textContent = 'ê¸°í•œë‚´: ì„ ê¸‰ê¸ˆ ~20ì¼ / ì¤‘ë„ê¸ˆÂ·ì”ê¸ˆ ~30ì¼ | ê´€ë¦¬: 21/31~90ì¼ | ì¥ê¸°ë¯¸ìˆ˜: 91ì¼~';
            } else if (track === 'B') {
                stageInfoEl.textContent = 'ê¸°í•œë‚´: ~40ì¼ | ê´€ë¦¬: 41~90ì¼ | ì¥ê¸°ë¯¸ìˆ˜: 91ì¼~';
            } else if (track === 'C') {
                stageInfoEl.textContent = 'ê¸°í•œë‚´: ~30ì¼ | ê´€ë¦¬: 31~90ì¼ | ì¥ê¸°ë¯¸ìˆ˜: 91ì¼~';
            }

            if (trackTotal > 0) {
                document.getElementById(`track${track}Bar`).innerHTML = `
                    <div class="normal" style="width: ${normalPct}%"></div>
                    <div class="manage" style="width: ${managePct}%"></div>
                    <div class="overdue" style="width: ${overduePct}%"></div>`;
            } else {
                document.getElementById(`track${track}Bar`).innerHTML = '';
            }
        }

        function renderDistribution() {
            const exclude = document.getElementById('distExcludeException').checked;
            // ì…ê¸ˆ ì™„ë£Œ ê±´ ì œì™¸
            let filtered = rawData.filter(r => !r['ì…ê¸ˆì¼']);
            if (exclude) filtered = filtered.filter(r => r['ì˜ˆì™¸ì—¬ë¶€'] !== 'Y');

            const ranges = [
                { label: '30ì¼ ë¯¸ë§Œ', min: 0, max: 29, class: 'dist-30', color: '#7cb342' },
                { label: '30-60ì¼', min: 30, max: 59, class: 'dist-60', color: '#e67e22' },
                { label: '60-90ì¼', min: 60, max: 89, class: 'dist-90', color: '#d35400' },
                { label: '90ì¼ ì´ìƒ', min: 90, max: 9999, class: 'dist-over', color: '#c0392b' }
            ];

            const total = filtered.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);

            let barHtml = '';
            let legendItems = [];

            ranges.forEach(range => {
                const rangeData = filtered.filter(r => r['ê²½ê³¼ì¼'] >= range.min && r['ê²½ê³¼ì¼'] <= range.max);
                const amount = rangeData.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);
                const pct = total > 0 ? (amount / total) * 100 : 0;

                if (pct > 0) {
                    barHtml += `<div class="distribution-segment ${range.class}" style="width: ${pct}%;" title="${range.label}: ${formatAmount(amount)}">${pct >= 10 ? pct.toFixed(0) + '%' : ''}</div>`;
                }

                legendItems.push({ label: range.label, count: rangeData.length, amount, pct, color: range.color });
            });

            document.getElementById('distributionBar').innerHTML = barHtml;

            // ë²”ë¡€ë¥¼ ë°” êµ¬ê°„ì— ë§ì¶° ë™ì  ë°°ì¹˜
            let legendHtml = '<div style="display:flex; width:100%;">';
            legendItems.forEach(item => {
                if (item.pct > 0) {
                    legendHtml += `<div style="width: ${item.pct}%; min-width: 80px; padding: 4px 2px;">
                        <div style="display:flex; align-items:center; gap:4px; font-size:11px; color:var(--text-muted);">
                            <div style="width:10px; height:10px; border-radius:2px; background:${item.color}; flex-shrink:0;"></div>
                            <span>${item.label}</span>
                        </div>
                        <div style="font-size:10px; color:var(--text-muted); padding-left:14px;">${item.count}ê±´ (${formatAmount(item.amount)})</div>
                    </div>`;
                }
            });
            legendHtml += '</div>';

            document.getElementById('distributionLegend').innerHTML = legendHtml;
        }

        function setActionTab(track) {
            actionTabTrack = track;
            document.querySelectorAll('#actionTabs .mini-tab').forEach(btn => {
                btn.classList.toggle('active',
                    (btn.textContent === 'ì „ì²´' && actionTabTrack === '') ||
                    (btn.textContent === 'ì»¨ì„¤íŒ…' && actionTabTrack === 'A') ||
                    (btn.textContent === 'ìì¬' && actionTabTrack === 'B') ||
                    (btn.textContent === 'íŠ¹í—ˆë£Œ' && actionTabTrack === 'C'));
            });
            renderActionList();
        }

        function setDueTab(track) {
            // ê°™ì€ íŠ¸ë™ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì „ì²´(í•´ì œ)
            dueTabTrack = (dueTabTrack === track) ? '' : track;
            document.querySelectorAll('#dueTabs .mini-tab').forEach(btn => {
                btn.classList.toggle('active',
                    (btn.textContent === 'ì»¨ì„¤íŒ…' && dueTabTrack === 'A') ||
                    (btn.textContent === 'ìì¬' && dueTabTrack === 'B') ||
                    (btn.textContent === 'íŠ¹í—ˆë£Œ' && dueTabTrack === 'C'));
            });
            renderDueList();
        }

        function setDueStatusTab(status) {
            dueStatusFilter = status;
            document.querySelectorAll('#dueStatusTabs .mini-tab').forEach(btn => {
                btn.classList.toggle('active',
                    (btn.textContent === 'ì „ì²´' && status === 'all') ||
                    (btn.textContent === 'ë„ë˜ ì˜ˆì •' && status === 'upcoming') ||
                    (btn.textContent === 'ê²½ê³¼' && status === 'overdue'));
            });
            renderDueList();
        }

        function setRankCardTab(card, track) {
            if (card === 'site') rankTrackSite = (rankTrackSite === track) ? '' : track;
            else if (card === 'amount') rankTrackAmount = (rankTrackAmount === track) ? '' : track;
            else if (card === 'days') rankTrackDays = (rankTrackDays === track) ? '' : track;
            const current = card === 'site' ? rankTrackSite : card === 'amount' ? rankTrackAmount : rankTrackDays;
            const tabId = card === 'site' ? 'rankSiteTabs' : card === 'amount' ? 'rankAmountTabs' : 'rankDaysTabs';
            document.querySelectorAll(`#${tabId} .mini-tab`).forEach(btn => {
                btn.classList.toggle('active',
                    (btn.textContent === 'ì»¨ì„¤íŒ…' && current === 'A') ||
                    (btn.textContent === 'ìì¬' && current === 'B') ||
                    (btn.textContent === 'íŠ¹í—ˆë£Œ' && current === 'C'));
            });
            if (card === 'site') renderTopSite();
            else if (card === 'amount') renderTopAmount();
            else renderTopDays();
        }

        function renderAllRanks() {
            renderTopSite();
            renderTopAmount();
            renderTopDays();
        }

        function renderActionList() {
            // ì…ê¸ˆ ì™„ë£Œ ê±´ ì œì™¸
            let baseData = rawData.filter(r => r['ì˜ˆì™¸ì—¬ë¶€'] !== 'Y' && !r['ì…ê¸ˆì¼']);
            if (actionTabTrack) baseData = baseData.filter(r => r['íŠ¸ë™'] === actionTabTrack);

            const actionItems = baseData.filter(r => {
                const days = r['ê²½ê³¼ì¼'] || 0;
                return (r['ë‹¨ê³„'] === 'ì •ìƒ' && days >= 10) || (r['ë‹¨ê³„'] === 'ê´€ë¦¬' && days >= 80);
            }).sort((a, b) => (b['ê²½ê³¼ì¼'] || 0) - (a['ê²½ê³¼ì¼'] || 0)).slice(0, 10);

            document.getElementById('actionCount').textContent = actionItems.length;

            if (actionItems.length === 0) {
                document.getElementById('actionList').innerHTML = '<div style="text-align:center; padding:30px; color:var(--text-muted);">ê¸ˆì£¼ ì•¡ì…˜ í•„ìš” ê±´ ì—†ìŒ</div>';
                return;
            }

            document.getElementById('actionList').innerHTML = actionItems.map(r => {
                const isToOverdue = r['ë‹¨ê³„'] === 'ê´€ë¦¬' && r['ê²½ê³¼ì¼'] >= 80;
                const borderColor = isToOverdue ? 'var(--danger)' : 'var(--warning)';
                const statusText = isToOverdue ? 'ì¥ê¸°ì „í™˜ ì„ë°•' : 'ê´€ë¦¬êµ¬ê°„ ë„ë˜';

                return `<div class="action-item" style="border-left-color: ${borderColor};" onclick="showCompanyDetail('${r['ì—…ì²´ëª…']}')">
                    <div class="action-info">
                        <div class="action-title">${r['ì—…ì²´ëª…']}</div>
                        <div class="action-sub">${r['í˜„ì¥ëª…'] || '-'} Â· ${r['êµ¬ë¶„']} Â· <span style="color:${borderColor}; font-weight:600;">${statusText}</span></div>
                    </div>
                    <div class="action-value">
                        <div class="action-amount">${formatAmount(r['ë¯¸ìˆ˜ê¸ˆì•¡'])}</div>
                        <div class="action-days" style="color:${borderColor};">${r['ê²½ê³¼ì¼']}ì¼</div>
                    </div>
                </div>`;
            }).join('');
        }

        function renderDueList() {
            const tStr = todayStr();

            // ì…ê¸ˆ ì™„ë£Œ ê±´ ì œì™¸
            let baseData = rawData.filter(r => r['ì˜ˆì™¸ì—¬ë¶€'] !== 'Y' && !r['ì…ê¸ˆì¼']);
            if (dueTabTrack) baseData = baseData.filter(r => r['íŠ¸ë™'] === dueTabTrack);

            let dueItems = baseData.filter(r => {
                const expectedDate = r['ì˜ˆìƒì…ê¸ˆì¼'] || r['ì˜ˆì •ì…ê¸ˆì¼'];
                if (!expectedDate) return false;
                const dd = diffDaysFromStr(normalizeDate(expectedDate), tStr);
                return dd <= 7;
            }).map(r => {
                const expectedDate = r['ì˜ˆìƒì…ê¸ˆì¼'] || r['ì˜ˆì •ì…ê¸ˆì¼'];
                const dd = diffDaysFromStr(normalizeDate(expectedDate), tStr);
                return { ...r, diffDays: dd };
            });

            // ë„ë˜/ê²½ê³¼ í•„í„° ì ìš©
            if (dueStatusFilter === 'upcoming') {
                dueItems = dueItems.filter(r => r.diffDays >= 0);
            } else if (dueStatusFilter === 'overdue') {
                dueItems = dueItems.filter(r => r.diffDays < 0);
            }

            dueItems = dueItems.sort((a, b) => a.diffDays - b.diffDays).slice(0, 10);

            document.getElementById('dueCount').textContent = dueItems.length;

            if (dueItems.length === 0) {
                const emptyMsg = dueStatusFilter === 'upcoming' ? 'ë„ë˜ ì˜ˆì • ê±´ ì—†ìŒ' : dueStatusFilter === 'overdue' ? 'ê²½ê³¼ ê±´ ì—†ìŒ' : 'ë„ë˜/ê²½ê³¼ ê±´ ì—†ìŒ';
                document.getElementById('dueList').innerHTML = `<div style="text-align:center; padding:30px; color:var(--text-muted);">${emptyMsg}</div>`;
                return;
            }

            document.getElementById('dueList').innerHTML = dueItems.map(r => {
                const isOverdue = r.diffDays < 0;
                const dateStr = r['ì˜ˆìƒì…ê¸ˆì¼'] || r['ì˜ˆì •ì…ê¸ˆì¼'] || '-';
                let dDayText;
                if (r.diffDays === 0) dDayText = 'D-Day';
                else if (r.diffDays > 0) dDayText = `D-${r.diffDays}`;
                else dDayText = `D+${Math.abs(r.diffDays)}`;

                let dDayColor;
                if (r.diffDays < 0) dDayColor = '#c0392b';       // ê²½ê³¼ (ë¹¨ê°•)
                else if (r.diffDays === 0) dDayColor = '#e67e22';  // ë‹¹ì¼ (ì£¼í™©)
                else if (r.diffDays <= 3) dDayColor = '#d35400';   // ì„ë°• (ì§™ì€ ì£¼í™©)
                else dDayColor = '#3B82F6';                        // ì—¬ìœ  (íŒŒë‘)

                const borderColor = r.diffDays < 0 ? '#c0392b' : r.diffDays <= 3 ? '#e67e22' : '#3B82F6';

                return `<div class="action-item" style="border-left-color: ${borderColor};" onclick="showCompanyDetail('${r['ì—…ì²´ëª…']}')">
                    <div class="action-info">
                        <div class="action-title">${r['ì—…ì²´ëª…']}</div>
                        <div class="action-sub">${r['í˜„ì¥ëª…'] || '-'} Â· ${dateStr}</div>
                    </div>
                    <div class="action-value">
                        <div class="action-amount">${formatAmount(r['ë¯¸ìˆ˜ê¸ˆì•¡'])}</div>
                        <div class="action-days" style="color: ${dDayColor}; font-weight:700;">${dDayText}</div>
                    </div>
                </div>`;
            }).join('');
        }

        function setRankSort(card, sort) {
            if (card === 'site') rankSortSite = sort;
            else if (card === 'amount') rankSortAmount = sort;
            else if (card === 'days') rankSortDays = sort;
            // ë²„íŠ¼ í™œì„± ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll(`.rank-sort-btn[data-card="${card}"]`).forEach(btn => {
                btn.classList.toggle('active', btn.dataset.sort === sort);
            });
            if (card === 'site') renderTopSite();
            else if (card === 'amount') renderTopAmount();
            else renderTopDays();
        }

        function getRankBaseData(card) {
            // ê° ì¹´ë“œë³„ ê°œë³„ ì˜ˆì™¸ì œì™¸ í† ê¸€
            const toggleId = card === 'site' ? 'rankSiteExcludeException' : card === 'amount' ? 'rankAmountExcludeException' : 'rankDaysExcludeException';
            const exclude = document.getElementById(toggleId).checked;
            // ì…ê¸ˆ ì™„ë£Œ ê±´ ì œì™¸
            let filtered = rawData.filter(r => !r['ì…ê¸ˆì¼']);
            if (exclude) filtered = filtered.filter(r => r['ì˜ˆì™¸ì—¬ë¶€'] !== 'Y');
            const track = card === 'site' ? rankTrackSite : card === 'amount' ? rankTrackAmount : rankTrackDays;
            if (track) filtered = filtered.filter(r => r['íŠ¸ë™'] === track);
            return filtered;
        }

        function renderTopSite() {
            const filtered = getRankBaseData('site');
            const bySite = {};
            filtered.forEach(r => {
                const name = r['í˜„ì¥ëª…'] || '(ë¯¸ì§€ì •)';
                if (!bySite[name]) bySite[name] = { amount: 0, count: 0, company: r['ì—…ì²´ëª…'], maxDays: 0 };
                bySite[name].amount += r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0;
                bySite[name].count++;
                bySite[name].maxDays = Math.max(bySite[name].maxDays, r['ê²½ê³¼ì¼'] || 0);
            });
            const sortByDays = rankSortSite === 'days';
            const sorted = Object.entries(bySite).sort((a, b) => sortByDays ? b[1].maxDays - a[1].maxDays : b[1].amount - a[1].amount).slice(0, 5);
            document.getElementById('topSiteList').innerHTML = sorted.length > 0 ? sorted.map((item, idx) => `
                <div class="rank-item" onclick="filterBySite('${item[0]}')">
                    <div class="rank-num ${idx < 3 ? 'top3' : ''}">${idx + 1}</div>
                    <div class="rank-info">
                        <div class="rank-name">${item[0]}</div>
                        <div class="rank-sub">${item[1].company} Â· ${item[1].count}ê±´</div>
                    </div>
                    <div class="rank-value"><div class="rank-amount ${sortByDays ? '' : 'highlight'}">${sortByDays ? item[1].maxDays + 'ì¼' : formatAmount(item[1].amount)}</div></div>
                </div>`).join('') : '<div style="text-align:center; padding:30px; color:var(--text-muted);">ë°ì´í„° ì—†ìŒ</div>';
        }

        function renderTopAmount() {
            const filtered = getRankBaseData('amount');
            const byCompany = {};
            filtered.forEach(r => {
                const name = r['ì—…ì²´ëª…'];
                if (!byCompany[name]) byCompany[name] = { amount: 0, count: 0, maxDays: 0 };
                byCompany[name].amount += r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0;
                byCompany[name].count++;
                byCompany[name].maxDays = Math.max(byCompany[name].maxDays, r['ê²½ê³¼ì¼'] || 0);
            });
            const sortByDays = rankSortAmount === 'days';
            const sorted = Object.entries(byCompany).sort((a, b) => sortByDays ? b[1].maxDays - a[1].maxDays : b[1].amount - a[1].amount).slice(0, 5);
            document.getElementById('topAmountList').innerHTML = sorted.length > 0 ? sorted.map((item, idx) => `
                <div class="rank-item" onclick="showCompanyDetail('${item[0]}')">
                    <div class="rank-num ${idx < 3 ? 'top3' : ''}">${idx + 1}</div>
                    <div class="rank-info">
                        <div class="rank-name">${item[0]}</div>
                        <div class="rank-sub">${item[1].count}ê±´ Â· ${sortByDays ? formatAmount(item[1].amount) : 'ìµœì¥ ' + item[1].maxDays + 'ì¼'}</div>
                    </div>
                    <div class="rank-value"><div class="rank-amount ${sortByDays ? '' : 'highlight'}">${sortByDays ? item[1].maxDays + 'ì¼' : formatAmount(item[1].amount)}</div></div>
                </div>`).join('') : '<div style="text-align:center; padding:30px; color:var(--text-muted);">ë°ì´í„° ì—†ìŒ</div>';
        }

        function renderTopDays() {
            const filtered = getRankBaseData('days');
            const byCompany = {};
            filtered.forEach(r => {
                const name = r['ì—…ì²´ëª…'];
                if (!byCompany[name]) byCompany[name] = { amount: 0, count: 0, maxDays: 0 };
                byCompany[name].amount += r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0;
                byCompany[name].count++;
                byCompany[name].maxDays = Math.max(byCompany[name].maxDays, r['ê²½ê³¼ì¼'] || 0);
            });
            const sortByDays = rankSortDays === 'days';
            const sorted = Object.entries(byCompany).sort((a, b) => sortByDays ? b[1].maxDays - a[1].maxDays : b[1].amount - a[1].amount).slice(0, 5);
            document.getElementById('topDaysList').innerHTML = sorted.length > 0 ? sorted.map((item, idx) => `
                <div class="rank-item" onclick="showCompanyDetail('${item[0]}')">
                    <div class="rank-num ${idx < 3 ? 'top3' : ''}">${idx + 1}</div>
                    <div class="rank-info">
                        <div class="rank-name">${item[0]}</div>
                        <div class="rank-sub">${item[1].count}ê±´ Â· ${sortByDays ? formatAmount(item[1].amount) : 'ìµœì¥ ' + item[1].maxDays + 'ì¼'}</div>
                    </div>
                    <div class="rank-value"><div class="rank-amount ${sortByDays ? '' : 'highlight'}">${sortByDays ? item[1].maxDays + 'ì¼' : formatAmount(item[1].amount)}</div></div>
                </div>`).join('') : '<div style="text-align:center; padding:30px; color:var(--text-muted);">ë°ì´í„° ì—†ìŒ</div>';
        }

        function showNoCommList() {
            // ì…ê¸ˆ ì™„ë£Œ ê±´ ì œì™¸
            const noCommData = rawData.filter(r =>
                !r['ì…ê¸ˆì¼'] &&
                r['ì˜ˆì™¸ì—¬ë¶€'] !== 'Y' &&
                !r['ì˜ˆìƒì…ê¸ˆì¼'] &&
                !r['ì˜ˆì •ì…ê¸ˆì¼']
            );

            const stageOrder = { 'ì—°ì²´': 0, 'ê´€ë¦¬': 1, 'ì •ìƒ': 2 };
            noCommData.sort((a, b) => {
                const stageA = stageOrder[a['ë‹¨ê³„']] ?? 3;
                const stageB = stageOrder[b['ë‹¨ê³„']] ?? 3;
                if (stageA !== stageB) return stageA - stageB;
                return (b['ê²½ê³¼ì¼'] || 0) - (a['ê²½ê³¼ì¼'] || 0);
            });

            const totalAmount = noCommData.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);

            document.getElementById('companyModalTitle').textContent = `íšŒì‹ ëŒ€ê¸° í˜„ì¥ (${noCommData.length}ê±´)`;

            let html = `<div style="margin-bottom: 16px; padding: 12px; background: var(--bg); border-radius: 8px;">
                <strong>ì´ ë¯¸ìˆ˜ê¸ˆ:</strong> ${formatFullAmount(totalAmount)}
                <span style="margin-left: 12px; color: var(--text-muted); font-size: 12px;">ì˜ˆìƒì…ê¸ˆì¼ ë¯¸í™•ë³´ í˜„ì¥</span>
            </div>`;

            if (noCommData.length === 0) {
                html += '<div style="text-align:center; padding:30px; color:var(--text-muted);">íšŒì‹ ëŒ€ê¸° í˜„ì¥ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            } else {
                html += '<table class="data-table"><thead><tr><th>ì—…ì²´ëª…</th><th>í˜„ì¥ëª…</th><th>êµ¬ë¶„</th><th class="amount">ë¯¸ìˆ˜ê¸ˆì•¡</th><th class="center">ê²½ê³¼ì¼</th><th class="center">ë‹¨ê³„</th><th>ì˜ˆì •ì…ê¸ˆì¼</th><th>í”„ë¡œì„¸ìŠ¤í˜„í™©</th></tr></thead><tbody>';

                noCommData.forEach(r => {
                    const stageClass = getStageClass(r['ë‹¨ê³„']);
                    const expectedDate = r['ì˜ˆìƒì…ê¸ˆì¼'] || r['ì˜ˆì •ì…ê¸ˆì¼'];
                    const expectedStr = expectedDate || '-';
                    html += `<tr>
                        <td>${r['ì—…ì²´ëª…'] || '-'}</td>
                        <td>${r['í˜„ì¥ëª…'] || '-'}</td>
                        <td>${r['êµ¬ë¶„'] || '-'}</td>
                        <td class="amount">${formatFullAmount(r['ë¯¸ìˆ˜ê¸ˆì•¡'])}</td>
                        <td class="center">${r['ê²½ê³¼ì¼']}ì¼</td>
                        <td class="center"><span class="badge badge-${stageClass}">${getDisplayStage(r['ë‹¨ê³„'])}</span></td>
                        <td>${expectedStr}</td>
                        <td>${r['í”„ë¡œì„¸ìŠ¤í˜„í™©'] || '-'}</td>
                    </tr>`;
                });

                html += '</tbody></table>';
            }

            document.getElementById('companyModalBody').innerHTML = html;
            document.getElementById('companyModal').classList.add('active');
        }

        function showExceptionList() {
            // ì…ê¸ˆ ì™„ë£Œ ê±´ ì œì™¸
            const exceptionData = rawData.filter(r => r['ì˜ˆì™¸ì—¬ë¶€'] === 'Y' && !r['ì…ê¸ˆì¼']);

            // ê²½ê³¼ì¼ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
            exceptionData.sort((a, b) => (b['ê²½ê³¼ì¼'] || 0) - (a['ê²½ê³¼ì¼'] || 0));

            const totalAmount = exceptionData.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);

            document.getElementById('companyModalTitle').textContent = `ì˜ˆì™¸ ì²˜ë¦¬ í˜„ì¥ (${exceptionData.length}ê±´)`;

            let html = `<div style="margin-bottom: 16px; padding: 12px; background: var(--bg); border-radius: 8px;">
                <strong>ì´ ì˜ˆì™¸ ì²˜ë¦¬ ê¸ˆì•¡:</strong> ${formatFullAmount(totalAmount)}
                <span style="margin-left: 12px; color: var(--text-muted); font-size: 12px;">ë¶„ìŸÂ·ê³„ì•½ë³€ê²½ ë“± íŠ¹ìˆ˜ ì‚¬ìœ  ê±´</span>
            </div>`;

            if (exceptionData.length === 0) {
                html += '<div style="text-align:center; padding:30px; color:var(--text-muted);">ì˜ˆì™¸ ì²˜ë¦¬ ê±´ì´ ì—†ìŠµë‹ˆë‹¤</div>';
            } else {
                html += `<div style="overflow-x:auto;"><table class="data-table" style="white-space:nowrap; font-size:12px;">
                    <thead><tr>
                        <th style="white-space:nowrap;">ì—…ì²´ëª…</th>
                        <th style="white-space:nowrap;">í˜„ì¥ëª…</th>
                        <th style="white-space:nowrap;">ì‹œê³µì‚¬</th>
                        <th class="amount" style="white-space:nowrap;">ë¯¸ìˆ˜ê¸ˆì•¡</th>
                        <th class="center" style="white-space:nowrap;">ê²½ê³¼ì¼</th>
                        <th class="center" style="white-space:nowrap;">ë‹¨ê³„</th>
                        <th style="white-space:nowrap;">ê³„ì‚°ì„œë°œí–‰ì¼</th>
                        <th style="min-width:120px;">ì˜ˆì™¸ì‚¬ìœ </th>
                    </tr></thead><tbody>`;

                exceptionData.forEach(r => {
                    const stageClass = getStageClass(r['ë‹¨ê³„']);
                    html += `<tr>
                        <td style="white-space:nowrap;">${r['ì—…ì²´ëª…'] || '-'}</td>
                        <td style="white-space:nowrap; max-width:180px; overflow:hidden; text-overflow:ellipsis;" title="${r['í˜„ì¥ëª…'] || ''}">${r['í˜„ì¥ëª…'] || '-'}</td>
                        <td style="white-space:nowrap;">${r['ì‹œê³µì‚¬'] || r['ì—…ì²´ëª…'] || '-'}</td>
                        <td class="amount" style="white-space:nowrap;">${formatFullAmount(r['ë¯¸ìˆ˜ê¸ˆì•¡'])}</td>
                        <td class="center" style="white-space:nowrap;">${r['ê²½ê³¼ì¼']}ì¼</td>
                        <td class="center" style="white-space:nowrap;"><span class="badge badge-${stageClass}">${getDisplayStage(r['ë‹¨ê³„'])}</span></td>
                        <td style="white-space:nowrap;">${r['ê³„ì‚°ì„œë°œí–‰ì¼'] || '-'}</td>
                        <td style="max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;" title="${r['ì˜ˆì™¸ì‚¬ìœ '] || r['ë¹„ê³ '] || ''}">${r['ì˜ˆì™¸ì‚¬ìœ '] || r['ë¹„ê³ '] || '-'}</td>
                    </tr>`;
                });

                html += '</tbody></table></div>';
            }

            document.getElementById('companyModalBody').innerHTML = html;
            document.getElementById('companyModal').classList.add('active');
        }

        function showCompanyDetail(companyName) {
            const companyData = rawData.filter(r => r['ì—…ì²´ëª…'] === companyName);
            const totalAmount = companyData.reduce((s, r) => s + (r['ë¯¸ìˆ˜ê¸ˆì•¡'] || 0), 0);

            const stageOrder = { 'ì—°ì²´': 0, 'ê´€ë¦¬': 1, 'ì •ìƒ': 2 };
            companyData.sort((a, b) => {
                const stageA = stageOrder[a['ë‹¨ê³„']] ?? 3;
                const stageB = stageOrder[b['ë‹¨ê³„']] ?? 3;
                if (stageA !== stageB) return stageA - stageB;
                return (b['ê²½ê³¼ì¼'] || 0) - (a['ê²½ê³¼ì¼'] || 0);
            });

            document.getElementById('companyModalTitle').textContent = `${companyName} ë¯¸ìˆ˜ê¸ˆ ìƒì„¸`;

            let html = `<div style="margin-bottom: 16px; padding: 12px; background: var(--bg); border-radius: 8px;">
                <strong>ì´ ë¯¸ìˆ˜ê¸ˆ:</strong> ${formatFullAmount(totalAmount)} (${companyData.length}ê±´)
            </div>`;

            html += '<table class="data-table"><thead><tr><th>í˜„ì¥ëª…</th><th>êµ¬ë¶„</th><th class="amount">ë¯¸ìˆ˜ê¸ˆì•¡</th><th class="center">ê²½ê³¼ì¼</th><th class="center">ë‹¨ê³„</th><th>ì˜ˆì •ì…ê¸ˆì¼</th><th>í”„ë¡œì„¸ìŠ¤í˜„í™©</th></tr></thead><tbody>';

            companyData.forEach(r => {
                const stageClass = getStageClass(r['ë‹¨ê³„']);
                const expectedDate = r['ì˜ˆìƒì…ê¸ˆì¼'] || r['ì˜ˆì •ì…ê¸ˆì¼'];
                const expectedStr = expectedDate || '-';
                html += `<tr>
                    <td>${r['í˜„ì¥ëª…'] || '-'}</td>
                    <td>${r['êµ¬ë¶„'] || '-'}</td>
                    <td class="amount">${formatFullAmount(r['ë¯¸ìˆ˜ê¸ˆì•¡'])}</td>
                    <td class="center">${r['ê²½ê³¼ì¼']}ì¼</td>
                    <td class="center"><span class="badge badge-${stageClass}">${getDisplayStage(r['ë‹¨ê³„'])}</span></td>
                    <td>${expectedStr}</td>
                    <td>${r['í”„ë¡œì„¸ìŠ¤í˜„í™©'] || '-'}</td>
                </tr>`;
            });

            html += '</tbody></table>';

            document.getElementById('companyModalBody').innerHTML = html;
            document.getElementById('companyModal').classList.add('active');
        }

        function filterBySite(siteName) {
            document.getElementById('searchInput').value = siteName;
            goToPage(1);
            document.querySelector('.card:last-child').scrollIntoView({ behavior: 'smooth' });
        }

        function setDetailTab(track) {
            currentTrack = track;
            currentPage = 1;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.track === track);
            });
            const titles = { '': 'ì „ì²´', 'A': 'ì»¨ì„¤íŒ…', 'B': 'ìì¬íŒë§¤', 'C': 'íŠ¹í—ˆê¸°ìˆ ìë¬¸ë£Œ' };
            document.getElementById('detailTitle').textContent = titles[track] + ' ìƒì„¸ ë‚´ì—­';
            renderDetailTable();
        }

        function resetFilters() {
            document.getElementById('filterStage').value = '';
            document.getElementById('filterException').value = '';
            document.getElementById('filterComm').value = '';
            document.getElementById('filterPaid').value = 'unpaid';
            document.getElementById('searchInput').value = '';
            currentPage = 1;
            renderDetailTable();
        }

        function setSortColumn(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'desc';
            }
            renderDetailTable();
        }

        function getFilteredData() {
            const stageFilter = document.getElementById('filterStage').value;
            const exceptionFilter = document.getElementById('filterException').value;
            const commFilter = document.getElementById('filterComm').value;
            const paidFilter = document.getElementById('filterPaid').value;
            const searchText = document.getElementById('searchInput').value.toLowerCase();

            let filtered = rawData;
            if (currentTrack) filtered = filtered.filter(r => r['íŠ¸ë™'] === currentTrack);
            // ì…ê¸ˆ ì—¬ë¶€ í•„í„°
            if (paidFilter === 'unpaid') filtered = filtered.filter(r => !r['ì…ê¸ˆì¼']);
            else if (paidFilter === 'paid') filtered = filtered.filter(r => r['ì…ê¸ˆì¼']);
            // ë‹¨ê³„ í•„í„°: í‘œì‹œê°’ì„ ë‚´ë¶€ê°’ìœ¼ë¡œ ë³€í™˜
            if (stageFilter) {
                const internalStage = stageInternalName[stageFilter] || stageFilter;
                filtered = filtered.filter(r => r['ë‹¨ê³„'] === internalStage);
            }
            if (exceptionFilter === 'Y') filtered = filtered.filter(r => r['ì˜ˆì™¸ì—¬ë¶€'] === 'Y');
            else if (exceptionFilter === 'N') filtered = filtered.filter(r => r['ì˜ˆì™¸ì—¬ë¶€'] !== 'Y');
            if (commFilter === 'Y') filtered = filtered.filter(r => r['ì˜ˆìƒì…ê¸ˆì¼'] || r['ì˜ˆì •ì…ê¸ˆì¼']);
            else if (commFilter === 'N') filtered = filtered.filter(r => !r['ì˜ˆìƒì…ê¸ˆì¼'] && !r['ì˜ˆì •ì…ê¸ˆì¼']);
            if (searchText) filtered = filtered.filter(r => (r['ì—…ì²´ëª…'] || '').toLowerCase().includes(searchText) || (r['í˜„ì¥ëª…'] || '').toLowerCase().includes(searchText));

            return filtered.sort((a, b) => {
                let aVal = a[sortColumn];
                let bVal = b[sortColumn];

                if (sortColumn === 'ë¯¸ìˆ˜ê¸ˆì•¡' || sortColumn === 'ê²½ê³¼ì¼') {
                    aVal = aVal || 0;
                    bVal = bVal || 0;
                } else if (sortColumn === 'ì˜ˆìƒì…ê¸ˆì¼') {
                    aVal = aVal ? new Date(aVal).getTime() : 0;
                    bVal = bVal ? new Date(bVal).getTime() : 0;
                } else {
                    aVal = aVal || '';
                    bVal = bVal || '';
                }

                if (sortDirection === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
        }

        function goToPage(page) { currentPage = page; renderDetailTable(); }

        function renderDetailTable() {
            const filtered = getFilteredData();
            const totalPages = Math.ceil(filtered.length / itemsPerPage);
            if (currentPage > totalPages) currentPage = totalPages || 1;

            const startIdx = (currentPage - 1) * itemsPerPage;
            const displayData = filtered.slice(startIdx, startIdx + itemsPerPage);

            document.querySelectorAll('#detailTable th').forEach(th => {
                th.classList.remove('sorted');
                const icon = th.querySelector('.sort-icon');
                if (icon) icon.textContent = 'â†•';
            });

            document.querySelector('#detailTable tbody').innerHTML = displayData.map((r, idx) => {
                const stage = r['ë‹¨ê³„'] || '';
                const stageClass = getStageClass(stage);
                const expectedDate = r['ì˜ˆìƒì…ê¸ˆì¼'] || r['ì˜ˆì •ì…ê¸ˆì¼'];
                const expectedStr = expectedDate || '-';
                const paidDate = r['ì…ê¸ˆì¼'] || '';
                const isPaid = !!r['ì…ê¸ˆì¼'];

                return `<tr class="clickable" onclick="showCompanyDetail('${r['ì—…ì²´ëª…']}')" style="${isPaid ? 'opacity: 0.55;' : ''}">
                    <td class="center">${startIdx + idx + 1}</td>
                    <td>${r['ì—…ì²´ëª…'] || '-'}</td>
                    <td>${r['í˜„ì¥ëª…'] || '-'}</td>
                    <td>${r['êµ¬ë¶„'] || '-'}</td>
                    <td class="amount">${formatFullAmount(r['ë¯¸ìˆ˜ê¸ˆì•¡'])}</td>
                    <td class="center">${r['ê²½ê³¼ì¼'] || 0}ì¼</td>
                    <td class="center"><span class="badge badge-${stageClass}">${getDisplayStage(stage)}</span></td>
                    <td>${expectedStr}</td>
                    <td class="center">${paidDate ? '<span class="badge badge-info">' + paidDate + '</span>' : '-'}</td>
                    <td class="center">${r['ì˜ˆì™¸ì—¬ë¶€'] === 'Y' ? '<span class="badge badge-purple">ì˜ˆì™¸</span>' : '-'}</td>
                </tr>`;
            }).join('');

            renderPagination(filtered.length, totalPages);
        }

        function renderPagination(totalItems, totalPages) {
            const container = document.getElementById('pagination');
            if (totalPages <= 1) { container.innerHTML = `<span class="page-info">ì „ì²´ ${totalItems}ê±´</span>`; return; }

            let html = `<button class="page-btn" onclick="goToPage(1)" ${currentPage === 1 ? 'disabled' : ''}>Â«</button>`;
            html += `<button class="page-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>â€¹</button>`;

            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            if (endPage - startPage < 4) startPage = Math.max(1, endPage - 4);

            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }

            html += `<button class="page-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>â€º</button>`;
            html += `<button class="page-btn" onclick="goToPage(${totalPages})" ${currentPage === totalPages ? 'disabled' : ''}>Â»</button>`;
            html += `<span class="page-info">ì „ì²´ ${totalItems}ê±´ ì¤‘ ${(currentPage-1)*itemsPerPage + 1}-${Math.min(currentPage*itemsPerPage, totalItems)}ê±´</span>`;

            container.innerHTML = html;
        }

        async function downloadExcel() {
            if (!originalFileBuffer) {
                alert('ì—…ë¡œë“œëœ ì›ë³¸ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ì—‘ì…€ íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.');
                return;
            }

            const filtered = getFilteredData();
            const isFullData = filtered.length === rawData.length;

            if (isFullData) {
                // ì „ì²´ ë°ì´í„° â†’ ì›ë³¸ ê·¸ëŒ€ë¡œ ë‹¤ìš´ë¡œë“œ
                const blob = new Blob([originalFileBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                triggerDownload(blob, originalFileName || 'ë¯¸ìˆ˜ê¸ˆ_ëŒ€ì‹œë³´ë“œ.xlsx');
                return;
            }

            // í•„í„° ì ìš© â†’ ì›ë³¸ XMLì—ì„œ í•´ë‹¹ í–‰ë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ ì‚­ì œ
            try {
                const zip = await JSZip.loadAsync(originalFileBuffer);

                // ì‹œíŠ¸ XML ì°¾ê¸°
                const sheetPath = 'xl/worksheets/sheet1.xml';
                const sheetXml = await zip.file(sheetPath).async('string');

                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(sheetXml, 'application/xml');
                const sheetData = xmlDoc.querySelector('sheetData');
                const allRows = Array.from(sheetData.querySelectorAll('row'));

                // ë³´ì¡´í•  ì—‘ì…€ í–‰ ë²ˆí˜¸ Set (1-based: ì—‘ì…€ í–‰ë²ˆí˜¸ = jsonì¸ë±ìŠ¤ + 1)
                const keepRowNums = new Set();

                // í—¤ë” í–‰ê³¼ ê·¸ ìœ„ì˜ í–‰ë“¤ì€ ëª¨ë‘ ë³´ì¡´
                for (let i = 0; i <= originalHeaderRowIdx; i++) {
                    keepRowNums.add(i + 1);
                }

                // í•„í„°ëœ ë°ì´í„°ì˜ ì›ë³¸ í–‰ ë²ˆí˜¸ ë³´ì¡´
                filtered.forEach(r => {
                    if (r['_originalRowIdx'] !== undefined) {
                        keepRowNums.add(r['_originalRowIdx'] + 1);
                    }
                });

                // ë³´ì¡´ ëŒ€ìƒì´ ì•„ë‹Œ í–‰ ì‚­ì œ
                allRows.forEach(rowEl => {
                    const rowNum = parseInt(rowEl.getAttribute('r'));
                    if (!keepRowNums.has(rowNum)) {
                        sheetData.removeChild(rowEl);
                    }
                });

                // ë‚¨ì€ í–‰ë“¤ì˜ í–‰ë²ˆí˜¸ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì¬ì •ë ¬ (1ë¶€í„°)
                const remainingRows = Array.from(sheetData.querySelectorAll('row'));
                remainingRows.forEach((rowEl, idx) => {
                    const newRowNum = idx + 1;
                    const oldRowNum = rowEl.getAttribute('r');
                    rowEl.setAttribute('r', newRowNum);

                    // í–‰ ë‚´ ì…€ì˜ ì°¸ì¡°ë„ ì—…ë°ì´íŠ¸ (ì˜ˆ: B5 â†’ B2)
                    const cells = rowEl.querySelectorAll('c');
                    cells.forEach(cell => {
                        const ref = cell.getAttribute('r');
                        if (ref) {
                            const colLetter = ref.replace(/[0-9]/g, '');
                            cell.setAttribute('r', colLetter + newRowNum);
                        }
                    });
                });

                // dimension ì—…ë°ì´íŠ¸
                const dimension = xmlDoc.querySelector('dimension');
                if (dimension) {
                    const refAttr = dimension.getAttribute('ref');
                    if (refAttr && refAttr.includes(':')) {
                        const endCol = refAttr.split(':')[1].replace(/[0-9]/g, '');
                        dimension.setAttribute('ref', 'A1:' + endCol + remainingRows.length);
                    }
                }

                // ì§ë ¬í™” í›„ ì €ì¥
                const serializer = new XMLSerializer();
                const newXml = serializer.serializeToString(xmlDoc);
                zip.file(sheetPath, newXml);

                const newBuffer = await zip.generateAsync({ type: 'blob', mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

                const titles = { '': 'ì „ì²´', 'A': 'ì»¨ì„¤íŒ…', 'B': 'ìì¬íŒë§¤', 'C': 'íŠ¹í—ˆê¸°ìˆ ìë¬¸ë£Œ' };
                const fileName = `ë¯¸ìˆ˜ê¸ˆí˜„í™©_${titles[currentTrack] || 'í•„í„°'}_${new Date().toISOString().slice(0,10)}.xlsx`;
                triggerDownload(newBuffer, fileName);

            } catch (err) {
                console.error('í•„í„° ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', err);
                alert('í•„í„° ì ìš© ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function triggerDownload(blob, fileName) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ê°™ì€ í´ë”ì˜ ì—‘ì…€ íŒŒì¼ì„ ìë™ìœ¼ë¡œ fetchí•˜ì—¬ ë¡œë“œ
        async function autoLoadExcelFromServer() {
            const xlsxFiles = ['data.xlsx', 'ë¯¸ìˆ˜ê¸ˆ_ëŒ€ì‹œë³´ë“œ_260210.xlsx'];
            for (const fileName of xlsxFiles) {
                try {
                    const response = await fetch('./' + encodeURIComponent(fileName));
                    if (response.ok) {
                        const arrayBuffer = await response.arrayBuffer();
                        originalFileBuffer = arrayBuffer.slice(0);
                        originalFileName = fileName;
                        processExcelData(arrayBuffer);
                        console.log('ì—‘ì…€ íŒŒì¼ ìë™ ë¡œë“œ ì™„ë£Œ:', fileName);
                        return true;
                    }
                } catch (e) { console.warn('ìë™ ë¡œë“œ ì‹¤íŒ¨:', fileName, e); }
            }
            return false;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ: ì„œë²„ ìš°ì„  â†’ ì‹¤íŒ¨ ì‹œ localStorage fallback
        async function initDashboard() {
            const serverLoaded = await autoLoadExcelFromServer();
            if (!serverLoaded) {
                loadDataFromStorage();
            }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initDashboard();
            });
        } else {
            initDashboard();
        }

        function formatDateForExcel(dateValue) {
            if (!dateValue) return '';
            try {
                const date = new Date(dateValue);
                if (isNaN(date.getTime())) return '';
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            } catch (e) {
                return '';
            }
        }
    </script>
</body>
</html>
